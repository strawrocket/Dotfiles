(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
var k=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};class aa{getMessage(a,b){return chrome.i18n.getMessage(a,b)}}var ba={en_GB:"en",en_US:"en",es_419:"es",fil:"tl",he:"iw",pt_BR:"pt-BR",pt_PT:"pt-PT",zh_CN:"zh-CN",zh_TW:"zh-TW"};class ca{get(a,b){chrome.storage.local.get(a,c=>{b(chrome.runtime.lastError?null:c)})}set(a){chrome.storage.local.set(a,function(){})}remove(a){chrome.storage.local.remove(a)}};const m=/([?&]oi=)([^&]+)/;function r(a){return(a.match(m)||["","",""])[2]}function u(a){return a.replace(m,"$1gsb"+("gsb20">=r(a)?"00":"50"))}function v(a,b){return u(a)==u(b)}function da(a,b,c){var d=new XMLHttpRequest;d.open(b?"POST":"GET","https://scholar.google.com/"+a,!0);d.onreadystatechange=()=>{4==d.readyState&&c(d.status,d.responseText)};d.timeout=3E4;b&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b?d.send(b):d.send()}
function w(a,b){let c=null;if(200==a){try{c=JSON.parse(b)}catch(d){}if("object"!=typeof c||c instanceof Array)c=null}return c};var x=class{constructor(a,b,c){this.type=a;this.link=b;this.time=c}},z=class{constructor(a,b){this.da=a;this.time=b}},B=function(a){const b=a.j.slice(a.o+1);a.j=a.j.slice(0,a.o+1);const c=a.O();var d=a.j.length-20;let e=0;for(;e<a.j.length&&36E5<c-a.j[e].time;)e+=1;d=Math.max(d,e);0<d&&(b.push(...a.j.slice(0,d)),a.j=a.j.slice(d,a.o+1),a.o=Math.max(a.o-d,-1));A(a,b);for(let f in a.C)36E5<c-a.C[f].time&&delete a.C[f]},A=function(a,b){const c={};for(var d=0;d<a.j.length;d++)c[a.j[d].link]=!0;for(d=0;d<
b.length;d++){const e=b[d].link;c[e]||(a.P["history-link-"+u(e)]=null)}},D=function(a){return a.j[a.o]||new x("home","",a.O())},E=function(a,b,c){a.P["history-link-"+u(b)]=c},F=function(a,b,c){a.C[b]=new z(c,a.O())},ea=class{constructor(){var a=Date.now;this.j=[];this.o=-1;this.C={};this.P={};this.O=a}add(a,b){-1!=this.o&&v(this.j[this.o].link,b)||(this.o+=1,this.j[this.o]=new x(a,b,this.O()),B(this))}replace(a,b){if(!(0>this.o)){--this.o;var c=this.j.slice(this.o+1);this.j=this.j.slice(0,this.o+
1);A(this,c);this.add(a,b)}}clear(){const a=this.j;this.j=[];this.o=-1;this.C={};A(this,a)}goForward(){this.o+1<this.j.length&&(this.o+=1)}goBack(){0<this.o&&--this.o}};var fa=function(a,b){a.ea.textContent=b;b=a.ea.innerHTML;return b.replace(a.ka,(c,d)=>"<"+d+">").replace(a.ja,(c,d)=>"&"+d+";")};class ha{constructor(){this.ka=/&lt;(\/?(b|i|em|br))&gt;/gi;this.ja=/&amp;([a-z0-9]+|#[0-9]+);/gi;this.ea=document.createElement("div")}};/[?&]tc=([01])/.exec(location.search||"")||0<=(navigator.userAgent||"").indexOf("Android")||window.matchMedia&&window.matchMedia("(pointer)").matches&&window.matchMedia("(pointer:coarse)");var G=class{constructor(a){this.T=a}},H=new G("A"),ia=new G("BUTTON"),I=new G("DIV"),ja=new G("FORM"),ka=new G("H3"),la=new G("IMG"),ma=new G("INPUT"),na=new G("SPAN"),oa=new G("TABLE"),pa=new G("TH");function J(a,b){a=document.createElement(a.T);a.className=b;return a}function K(a,b){a=document.createElement(a.T);a.id=b;return a}function L(a,b,c=""){const d=document.createElement(H.T);d.href=a&&a.match(qa)?a:"javascript:void(0)";d.textContent=b;c&&(d.className=c);return d}
const qa=/^(?:https?:|[^:/?#]*(?:[/?#]|$))/i,ra=/^(?:#|\/[a-z0-9_-]*(?:[?].*)?$)/i;function N(a,b){const c=b.length;for(let d=0;d<c;d++)a.appendChild(b[d])};var sa=function(a){a.S.get(["authuser","history","history-index","history-patch-map"],b=>{b=b||{};a.V=b.authuser||"0";var c=a.j,d=b.history,e=b["history-index"];b=b["history-patch-map"];if("number"==typeof e&&Number.isInteger(e)){var f=[];if(Array.isArray(d))for(var h=0;h<d.length;h++){var g=d[h];"string"==typeof g.t&&"string"==typeof g.l&&"number"==typeof g.s&&f.push(new x(g.t,g.l,g.s))}c.j=f;c.o=0<=e&&e<c.j.length?e:-1;d={};if(Array.isArray(b))for(e=0;e<b.length;e++)f=b[e],"string"==typeof f.d&&
"string"==typeof f.c&&"number"==typeof f.t&&(d[f.d]=new z(f.c,f.t));c.C=d}B(c);c=document.body;c.setAttribute("dir",a.A.getMessage("@@bidi_dir"));c.innerHTML="";b=K(I,"header");d=K(ia,"search-button");d.type="submit";N(a.F,[a.ca]);N(a.Z,[d,a.R,a.F]);N(b,[a.Z]);e=K(I,"middle");N(e,[a.B,a.N]);f=K(I,"footer");h=K(I,"progress-inc");g=K(I,"progress-dec");N(a.ia,[h,g]);h=K(I,"footer-buttons");for(const l of[a.D,a.G])l.setAttribute("href","#"),l.setAttribute("role","button");O(a);P(a,"");a.aa.setAttribute("href",
"/scholar_settings?oi=gsb&"+Q(a));a.Y.setAttribute("href","/scholar?scilib=1&"+Q(a));N(h,[a.D,a.G,a.H,a.Y,a.aa]);N(f,[a.I,a.ia,h]);N(c,[b,e,f]);document.title=a.A.getMessage("853");d.title=a.A.getMessage("920");a.F.title=a.A.getMessage("1300");a.D.title=a.A.getMessage("1298");a.G.title=a.A.getMessage("1299");a.Y.title=a.A.getMessage("732");a.H.title=a.A.getMessage("1108");a.aa.title=a.A.getMessage("1301");a.Z.addEventListener("submit",a.na.bind(a));c.addEventListener("click",a.fa.bind(a));c.addEventListener("auxclick",
a.fa.bind(a));c.addEventListener("focus",a.la.bind(a),!0);R(a,!0);void 0!==a.ha&&S(a,a.ha)})},O=function(a){a.D.classList.toggle("disabled",!(0<a.j.o));var b=a.j;a.G.classList.toggle("disabled",!(b.o+1<b.j.length))},P=function(a,b){b=b.replace(/([?&])(output|hl|authuser)=[^&]*/g,"$1").replace(/([?&])&+/g,"$1").replace(/&$/,"");a.H.setAttribute("href","/"+(b+(0<=b.indexOf("?")?"&":"?"))+(r(b)?"":"oi=gsb&")+(b?"lookup=0&":"")+Q(a))},Q=function(a){const b="0"==a.V?"":"&authuser="+a.V;a=a.A.getMessage("@@ui_locale");
return"hl="+(ba[a]||a)+b},R=function(a,b){document.body.classList.toggle("busy",b);T(a,"");U(a,"");a.N.classList.toggle("busy",b)},S=function(a,b){V(a,b);a.R.focus();P(a,"gsb20">=r(b)?"?oi=gsb00":b);ta(a,b||"scholar?oi=gsb00&q=")},T=function(a,b){a.N.textContent=b},U=function(a,b,c=""){clearTimeout(a.ga);a.ga=setTimeout(()=>{a.I.innerHTML=""},3E3);a.I.innerHTML=b;a.I.className=c},ua=function(a){T(a,a.A.getMessage("1107")+" ");a.N.appendChild(L(a.H.getAttribute("href"),a.A.getMessage("1108")))},V=
function(a,b){b=va(b);a.R.value=b},ta=function(a,b){R(a,!0);b=b+(0<=b.indexOf("?")?"&":"?")+"output=gsb&"+Q(a);a.j.add("search",b);W(a);O(a);a.J(b,"",a.X.bind(a,b))},W=function(a){const b={},c=[];var d=a.j;const e=d.P;var f=d.j,h=[];for(let g=0;g<f.length;g++){const l=f[g];h.push({t:l.type,l:l.link,s:l.time})}e.history=h;e["history-index"]=d.o;f=d.C;h=[];for(let g in f)h.push({d:g,c:f[g].da,t:f[g].time});e["history-patch-map"]=h;d.P={};for(let g in e)null!=e[g]?b[g]=e[g]:c.push(g);a.S.set(b);a.S.remove(c)},
wa=function(a,b){R(a,!0);b="scholar?q=info:"+encodeURIComponent(b)+":scholar.google.com/&output=gsb-cite&"+Q(a);a.j.add("cite",b);W(a);O(a);P(a,b);V(a,b);a.J(b,"",a.W.bind(a,b))},xa=function(a,b){return"#citations?update_op=library_add&citilm=1&xsrf="+encodeURIComponent(a.ba)+"&info="+encodeURIComponent(b)+"&user="+encodeURIComponent(a.K)+"&"+Q(a)},ya=function(a,b){return"#citations?update_op=trash_citations&citilm=1&json=&xsrf="+encodeURIComponent(a.ba)+"&s="+encodeURIComponent(a.K)+":"+encodeURIComponent(b)+
"&"+Q(a)},za=function(a,b,c){b.classList.contains("spin")||(b.classList.add("spin"),a.I.innerHTML="",a.J(c,"",a.ma.bind(a,b)))},va=function(a){if("gsb20">=r(a)||0<a.indexOf("&output=gsb-cite"))return"";a=(a.match(/^.*[?&]q=([^&]+).*$/)||["",""])[1];return decodeURIComponent(a.replace(/[+]/g,"%20"))},X=function(a,b){return fa(a.pa,(b||"")+"")},Aa=function(a,b,c,d){const e="history-link-"+u(b);a.S.get(e,f=>{f=(f||{})[e];"string"==typeof f?c(f):d()})};
class Ba{constructor(a,b){var c=new ca;this.A=new aa;this.oa=a;this.J=b;this.pa=new ha;this.S=c;this.H=K(H,"full-screen");this.aa=K(H,"settings");this.Y=K(H,"library");this.D=K(H,"back");this.G=K(H,"forward");this.F=K(H,"account");this.ca=K(la,"account-img");this.ia=K(I,"progress");this.Z=K(ja,"search-form");this.R=K(ma,"search-box");this.B=K(I,"main");this.N=K(I,"message");this.I=K(I,"library-message");this.ba=this.K="";this.ga=0;this.j=new ea;sa(this)}X(a,b,c,d=!1){function e(M,C){M&&(C.firstChild&&
C.appendChild(document.createTextNode(" ")),C.appendChild(M))}if(v(D(this.j).link,a)){this.B.innerHTML="";R(this,!1);var f=w(b,c)||{};b=f.r;if(b instanceof Array&&!f.L){var h=Math.min(b.length,3);this.K=(f.u||"")+"";this.ba=(f.x||"")+"";this.ca.src=(f.p||"")+""||"https://lh3.googleusercontent.com/a/default-user=s64";this.F.setAttribute("href","https://accounts.google.com/"+(this.K?"SignOutOptions":"Login")+"?continue="+encodeURIComponent("https://scholar.google.com"+this.H.getAttribute("href"))+"&"+
Q(this));if(!d&&!va(a)&&!a.match(/[?&]title=/)){if(0>=h||!f.h){this.j.replace("home","");O(this);W(this);return}P(this,a)}E(this.j,D(this.j).link,c);for(a=0;a<h;a++){var g=b[a];if(!k(g))continue;var l=X(this,g.t),y=(g.u||"")+"";const M=X(this,g.x);var t=X(this,g.m),p=X(this,g.s),n=g.l||{};if(l&&k(n)){c={};for(let C in n)f=n[C],k(f)&&(c[C]=L((f.u||"")+"",(f.l||"")+"",C));f=J(I,"result");var q=void 0;if(this.K&&n.f&&k(n.f)&&n.f.u&&(g=(g.c||"")+"",n=(n.f.u+"").substring(2))){if(q=this.j.C[n])d?g=q.da:
F(this.j,n,g);g?(q=L(ya(this,g),"","library-star"),q.classList.add("saved"),q.setAttribute("title",this.A.getMessage("96"))):(q=L(xa(this,n),"","library-star"),q.setAttribute("title",this.A.getMessage("64")));q.setAttribute("data-docid",n)}n=J(ka,"result-title");g="";M&&(g=J(na,"result-marker"),g.innerHTML="["+M+"]",g=g.outerHTML+" ");l=g+l;y?(y=L(y,l),y.innerHTML=l,n.appendChild(y)):n.innerHTML=l;f.appendChild(n);t&&(y=J(I,"result-metadata"),y.innerHTML=t,f.appendChild(y));p&&1==h&&(t=J(I,"result-snippet"),
t.innerHTML=p,f.appendChild(t));p=J(I,"result-links");q&&(q.innerHTML='<svg viewBox="0 0 16 16"><path d="M8 11.57l3.824 2.308-1.015-4.35 3.379-2.926-4.45-.378L8 2.122 6.261 6.224l-4.449.378 3.379 2.926-1.015 4.35z"/></svg>',q.setAttribute("role","button"),e(q,p));if(t=c.f)t.innerHTML='<svg viewBox="0 0 16 16"><path d="M1.5 3.5v5h2v.375L1.75 12.5h3L6.5 8.875V3.5zM9.5 3.5v5h2v.375L9.75 12.5h3L14.5 8.875V3.5z"/></svg>'+t.innerHTML,t.setAttribute("role","button"),e(t,p);e(c.c,p);e(c.r,p);e(c.v,p);p.firstChild&&
f.appendChild(p);p=J(I,"result-access");e(c.g,p);e(c.l,p);p.firstChild&&f.appendChild(p);this.B.appendChild(f)}}this.B.firstChild||T(this,this.A.getMessage("1109"));W(this)}else ua(this)}}W(a,b,c){if(v(D(this.j).link,a)){this.B.innerHTML="";R(this,!1);var d=w(b,c)||{};b=d.l;a=d.i||[];if(b instanceof Array&&a instanceof Array&&!d.L){d=Math.min(b.length,5);E(this.j,D(this.j).link,c);W(this);c=K(oa,"cite");for(var e=0;e<d;e++){var f=b[e];if(!k(f))continue;var h=X(this,f.l);f=X(this,f.h);if(!h||!f)continue;
const g=c.insertRow();g.tabIndex=0;const l=document.createElement(pa.T);l.scope="row";l.innerHTML=h;g.appendChild(l);g.insertCell(-1).innerHTML=f}b=Math.min(a.length,5);d=K(I,"import");for(e=0;e<b;e++)h=a[e],k(h)&&(d.firstChild&&d.appendChild(document.createTextNode(" ")),d.appendChild(L((h.u||"")+"",(h.l||"")+"")));c.firstChild?(this.B.appendChild(c),this.B.appendChild(d)):T(this,this.A.getMessage("1109"))}else ua(this)}}ma(a,b,c){a.classList.remove("spin");const d=w(b,c)||{};c=a.getAttribute("data-docid")||
"";const e=a.classList.contains("saved");d.L?(a=this.A.getMessage(e?"1289":"1287"),U(this,a,"error")):d.M?U(this,""+d.M,"error"):200==b&&e&&c?(a.classList.remove("saved"),a.setAttribute("href",xa(this,c)),a.setAttribute("title",this.A.getMessage("64")),F(this.j,c,"")):Array.isArray(d.U)&&1==d.U.length&&k(d.U[0])&&!e?(a.classList.add("saved"),b=d.U[0].c.split(":")[1]||"",a.setAttribute("href",ya(this,b)),a.setAttribute("title",this.A.getMessage("96")),F(this.j,c,b),U(this,this.A.getMessage("1285",
['<a href="/scholar?scilib=1&'+Q(this)+'">',"</a>"]))):(a=this.A.getMessage(e?"1289":"1287"),U(this,a,"error"));W(this)}na(a){const b="scholar?oi=gsb95&q="+encodeURIComponent(this.R.value);P(this,b);ta(this,b);a.preventDefault()}fa(a){if(!(1<a.button)){var b=document.body;for(let c=a.target;c!=b;c=c.parentElement){const d=1==c.nodeType&&c.getAttribute("href")||"";if(c.classList.contains("disabled")){a.preventDefault();break}else if(c==this.D||c==this.G){a.preventDefault();c==this.D?this.j.goBack():
this.j.goForward();const e=D(this.j);"home"==e.type?(this.B.innerHTML="",R(this,!1)):"search"==e.type?Aa(this,e.link,f=>{this.X(e.link,200,f,!0)},()=>{R(this,!0);this.J(e.link,"",this.X.bind(this,e.link))}):"cite"==e.type&&Aa(this,e.link,f=>{this.W(e.link,200,f)},()=>{R(this,!0);this.J(e.link,"",this.W.bind(this,e.link))});P(this,e.link);V(this,e.link);O(this);W(this);break}else if("#f"==d.substr(0,2)){a.preventDefault();wa(this,d.substr(2));break}else if("#c"==d.substr(0,2)){a.preventDefault();za(this,
c,d.substr(1));break}else if(d){a.preventDefault();c==this.F&&(this.j.clear(),W(this));this.oa(("/"==d[0]?"https://scholar.google.com":"")+d);break}}}}la(a){a=a.target;if("TR"==a.nodeName){const b=a.querySelector("td");b&&setTimeout(()=>{window.getSelection().selectAllChildren(b)},20)}}};const Y=new Ba(a=>{chrome.tabs.create({url:a})},(a,b,c)=>{da(a,b,c)});function Ca(a){if(!a||("/"+a).match(ra)&&/^(scholar|scholar_lookup)[?]\S*$/.test(a))Y.V?S(Y,a):Y.ha=a}function Da(a){return chrome.scripting.executeScript({target:{tabId:Z,allFrames:a},injectImmediately:!0,files:["contentscript_isolated-compiled.js"]}).then(b=>{let c="";for(const {result:e}of b)if("string"===typeof e){b=e;var d=c;const f=r(b),h=r(d);(f!=h?f>h:b.length>d.length)&&(c=e)}return c},()=>"")}let Z;
chrome.runtime.onMessage.addListener((a,b)=>{"getTopEmbedSelectedText"===a?void 0!==Z&&chrome.scripting.executeScript({target:{tabId:Z},files:["contentscript_main-compiled.js"],world:"MAIN"}):"getReaderSelectedText"===a&&chrome.runtime.sendMessage("dahenjhkoodjbpjheillcadbppiidmhp",{type:"getSelectedText",frameId:b.frameId})});
chrome.runtime.onMessageExternal.addListener((a,b)=>{"chrome-extension://dahenjhkoodjbpjheillcadbppiidmhp"===b.origin&&a&&"object"===typeof a&&"getSelectedTextReply"===a.type&&"number"===typeof a.frameId&&void 0!==Z&&chrome.tabs.sendMessage(Z,a,{frameId:a.frameId})});chrome.tabs.query({active:!0,currentWindow:!0},a=>{if(0>=a.length||void 0===(Z=a[0].id))Ca("");else{a=Da(!0);var b=0,c=new Promise(d=>{b=setTimeout(function(){d(Da(!1))},300)});Promise.race([a,c]).then(d=>{clearTimeout(b);Ca(d)})}});}).call(this);
