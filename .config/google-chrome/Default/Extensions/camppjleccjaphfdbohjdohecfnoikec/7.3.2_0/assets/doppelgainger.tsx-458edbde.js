import{j as e,M as S,r as I,a as L,R as j,b as U}from"./constants-e5712b98.js";import{c as F}from"./font-e4ec73e1.js";import{A as $,C as _,R as A,a as T}from"./index-f00bab01.js";import{T as D}from"./themeContext-b5ecfc73.js";import{c as z}from"./index-0c67d257.js";import{g as W,U as C,q as H,Q as G,o as Q}from"./index-5ad58ea9.js";import{u as V}from"./useUrlChange-a71e3939.js";import{u as E}from"./i18n-6c9556b7.js";import{f as k}from"./analytics-e24f0cc0.js";import{c as J}from"./createReactComponent-85aa5d18.js";import{T as X}from"./index-d6d87676.js";import{I as K}from"./IconArrowUpRight-d5ae139c.js";import{I as Y}from"./IconReload-9b2d2e3d.js";import{I as Z}from"./IconX-5b78e9ec.js";import{g as O,s as ee}from"./cache-2436a988.js";import{d as B}from"./debounce-c70d88e0.js";import"./useMedia-c48a250e.js";import"./motion-ec7ce7e0.js";var te=J("external-link","IconExternalLink",[["path",{d:"M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6",key:"svg-0"}],["path",{d:"M11 13l9 -9",key:"svg-1"}],["path",{d:"M15 4h5v5",key:"svg-2"}]]);const ne=({twitterUsername:n})=>{const{t}=E();return e.jsx("div",{className:"gradient-animated group rounded-full p-[1px]",children:e.jsxs("a",{href:`${S.DOMAIN}/doppelgainger/${n}`,target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 whitespace-nowrap rounded-full bg-white p-[10px] text-[15px] font-semibold leading-none text-slate-900 dark:bg-black dark:text-white",onClick:()=>{k({eventName:"chatWithAIPersona",eventType:"Button",feature:"Doppelgainger",firedFromFile:"components/doppelgainger/chatWithDoppelgaingerButton.tsx"})},children:[e.jsx("span",{children:t("dope_ai.chat_with_ai")}),e.jsx(te,{size:15})]})})},re=({handleClick:n,loading:t})=>{const{t:r}=E(),{...o}=I.useContext($);return!(o!=null&&o.isLoading)&&!(o!=null&&o.isAuthenticated)?e.jsx("button",{type:"button",className:"border-cornblue-400 ml-auto w-[240px] rounded-full border bg-white p-[10px] text-[15px] font-semibold leading-none text-slate-900 dark:bg-black dark:text-white",onClick:()=>window.open(L,"_blank"),children:r("dope_ai.login")}):t?e.jsxs("div",{className:"p-3 ml-auto bg-white border rounded-full dark:bg-black",children:[e.jsx("span",{className:"sr-only",children:r("load")}),e.jsxs("div",{className:"relative top-[2px] flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 animate-bounce rounded-full bg-slate-300 [animation-delay:-0.037s] dark:bg-slate-600"}),e.jsx("div",{className:"h-1.5 w-1.5 animate-bounce rounded-full bg-slate-300 [animation-delay:-0.074s] dark:bg-slate-600"}),e.jsx("div",{className:"h-1.5 w-1.5 animate-bounce rounded-full bg-slate-300 [animation-delay:-0.113s] dark:bg-slate-600"})]})]}):e.jsx("div",{className:"gradient-animated group rounded-full p-[1px]",children:e.jsxs("button",{type:"button",className:"whitespace-nowrap rounded-full bg-white p-[10px] text-[15px] font-semibold leading-none text-slate-900 dark:bg-black dark:text-white",onClick:()=>{n(),k({eventName:"CreateDoppelgainger",eventType:"Button",feature:"Doppelgainger",firedFromFile:"components/doppelgainger/createButton.tsx"})},children:[e.jsx("div",{className:"invisible group-hover:visible",children:e.jsx(X,{text:r("dope_ai.convert")})}),r("dope_ai.create")]})})},oe="/assets/doppelgainger-banner-37b67acc.png",N=({handleClick:n,status:t})=>e.jsx("button",{type:"button",className:"ml-auto self-start text-white",onClick:()=>{n(),k({eventData:`ModalStatus:${t}`,eventName:"DoppelgaingerModalClose",eventType:"Button",feature:"Doppelgainger",firedFromFile:"components/doppelgainger/createButton.tsx"})},children:e.jsx(Z,{size:20})}),R=()=>e.jsx("div",{className:"flex max-w-xl items-center gap-4 rounded-2xl bg-zinc-800 p-2",children:e.jsx("img",{src:W(oe),alt:"doppelgainger-in-personas",className:"rounded-xl"})}),se=({abortRef:n,buildDoppelgainger:t,modalStatus:r,profileName:o,setModalStatus:a})=>{const{t:s}=E(),i=()=>a(null),m=()=>window.location.reload();return r?e.jsxs("div",{className:"fixed left-0 top-0 z-50 flex h-screen w-screen items-center justify-center bg-opacity-10 backdrop-blur-sm backdrop-filter ",children:[r==="CONFIRMATION"&&e.jsxs("div",{className:"flex gap-4 rounded-2xl bg-zinc-800/90 p-4",children:[e.jsx("div",{className:"rounded-lg bg-zinc-100/10 p-4 text-7xl",children:"âš™ï¸"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xl font-semibold text-zinc-100",children:[s("dope_ai.build_own"),"Â ",e.jsx("span",{className:"bg-gradient-to-r from-pink-300 to-blue-100 bg-clip-text text-transparent",children:o}),"Â ",s("ai")]}),e.jsx("div",{className:"mb-4 text-xs text-zinc-300",children:s("dope_ai.this_cost")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",className:"bg-cornblue-600 hover:bg-cornblue-700 rounded px-6 py-2 text-sm text-white",onClick:()=>{t()},children:"Build Now"}),e.jsx("button",{type:"button",className:"rounded border px-6 py-2 text-sm text-white",onClick:i,children:s("dope_ai.quit")})]})]}),e.jsx(N,{status:"CONFIRMATION",handleClick:i})]}),r==="INPROGRESS"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 rounded-2xl bg-zinc-800 p-4",children:[e.jsx("div",{className:"rounded-lg bg-zinc-700 p-5 text-6xl",children:(()=>{const l=["ðŸ¦","ðŸ¯","ðŸ»","ðŸ¼","ðŸ¦„","ðŸ®","ðŸ”"];return l[Math.floor(Math.random()*l.length)]})()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold text-zinc-100",children:s("dope_ai.creating_ur_ai")}),e.jsx("div",{className:"mb-4 text-sm text-rose-300",children:s("dope_ai.dont_change_tab")}),e.jsx("div",{className:"mt-4 h-3 w-full rounded-full bg-zinc-700",children:e.jsx("div",{className:"animate-progress-scraping h-3 w-10 rounded-full bg-blue-600"})})]}),e.jsx(N,{status:"INPROGRESS",handleClick:()=>{n.current=!0,i()}})]}),e.jsx(R,{})]}),r==="SUCCESS"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 rounded-2xl bg-zinc-800 p-4",children:[e.jsx("div",{className:"rounded-lg bg-zinc-700 p-5 text-6xl",children:e.jsx("div",{className:"animate-bounce",children:"ðŸŽ‰"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold text-zinc-100",children:s("dope_ai.redirecting")}),e.jsx("div",{className:"mb-4 text-sm text-zinc-200",children:(()=>{const l=[s("dope_ai.just_a_moment"),"<name> is waiting for you on the other side","Get ready to meet AI <name>, any second now","Prepare for the grand unveiling of AI <name>","<name> AI is being trained, hold on tight"];return l[Math.floor(Math.random()*l.length)].replace("<name>",o)})()})]}),e.jsx(N,{status:"SUCCESS",handleClick:i})]}),e.jsx(R,{})]}),r==="INSUFFICIENT_DATA"&&e.jsxs("div",{className:"flex gap-4 rounded-2xl bg-zinc-800 p-4",children:[e.jsx("div",{className:"rounded-lg bg-zinc-700 p-4 text-7xl",children:"ðŸ˜¢"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-zinc-100",children:s("dope_ai.aint_enough")}),e.jsxs("div",{className:"mb-6 text-xs text-zinc-300",children:[s("dope_ai.insufficient_tweets"),e.jsx("br",{}),s("dope_ai.try_another_profile")]}),e.jsxs("a",{className:"text-cornblue-500 flex text-sm underline",href:"https://twitter.com/iamsrk",children:[e.jsx("span",{children:"E.g. @iamsrk"})," ",e.jsx(K,{size:14})]})]}),e.jsx(N,{status:"INSUFFICIENT_DATA",handleClick:i})]}),r==="ERROR"&&e.jsxs("div",{className:"flex gap-4 rounded-2xl bg-zinc-800 p-4",children:[e.jsx("div",{className:"rounded-lg bg-zinc-700 p-4 text-7xl",children:"â—ï¸"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-zinc-100",children:s("dope_ai.something_wrong")}),e.jsx("div",{className:"mb-6 text-xs text-zinc-200",children:s("dope_ai.try_later")}),e.jsxs("button",{type:"button",className:"bg-cornblue-600 flex items-center gap-2 rounded px-6 py-2 text-sm text-white",onClick:m,children:[e.jsx(Y,{size:14})," ",s("dope_ai.retry")]})]}),e.jsx(N,{status:"ERROR",handleClick:i})]})]}):null},ae=()=>new Promise(n=>{const t=new MutationObserver(B(()=>{var o,a;const r=((o=document.querySelector('[data-testid="placementTracking"]'))==null?void 0:o.parentElement)||((a=document.querySelector('[data-testid="editProfileButton"]'))==null?void 0:a.parentElement);r&&(n(r),t.disconnect())},300));t.observe(document.body,{childList:!0,subtree:!0})});async function ie(n){try{return(await C.put(`/doppelgainger/status/${n}`)).data.data}catch(t){return console.error(t),null}}const q=async n=>{const t=await O("doppelgaingers"),a=[...(t==null?void 0:t.data)||[],{...n,type:"doppelgainger"}].filter((s,i,m)=>m.findIndex(l=>l.id===s.id)===i);await ee("doppelgaingers",a,60*24)},le=async n=>{const t=await O("doppelgaingers"),r=(t==null?void 0:t.data)||[];return r.some(a=>a.id===n)||r.some(a=>a.userName===`@${n}`)},M=(n=["home","explore","notifications","messages","bookmarks","lists","profile","more","i","communities","settings","photo","compose","search"])=>{if(!window.location.href.includes("twitter.com")&&!window.location.href.includes("x.com"))return!1;const t=window.location.pathname.split("/").filter(Boolean);if(t.length===1){const r=t[0].replace(/[@\s]/g,"").toLowerCase();return!n.includes(r)}return!1},ce=()=>{const t=window.location.href.split("/");return t[t.length-1]},de=()=>{try{const t=document.querySelector('[data-testid="UserName"]').querySelector('div[dir="ltr"]');return t==null?void 0:t.textContent}catch{return null}},pe=()=>{var n,t,r,o;try{const a=document.querySelector('[aria-label="Profile"]'),s=document.querySelector('[data-testid="UserName"]'),[i,m]=s.querySelectorAll('div[dir="ltr"]'),l=document.querySelector('[data-testid="UserDescription"]'),d=document.querySelector('[data-testid="UserProfileHeader_Items"]'),x=(n=document.querySelector('img[src^="https://pbs.twimg.com/profile_banners/"]'))==null?void 0:n.getAttribute("src"),u=(t=a==null?void 0:a.getAttribute("href"))==null?void 0:t.slice(1),h=i.textContent,b=m.textContent,g=l==null?void 0:l.textContent,c=window.location.href.split("?")[0],f=d?Array.from(d.childNodes).map(w=>w.textContent).join(" ").replace(/\s{2,}/g," "):null;let p=((o=(r=document.querySelector('[aria-label="Opens profile photo"]'))==null?void 0:r.querySelector("img"))==null?void 0:o.getAttribute("src"))||"https://cdn.jsdelivr.net/gh/foyer-work/cdn-files/placeholder.svg";return(p!=null&&p.endsWith("_normal.jpg")||p!=null&&p.endsWith("_normal.png"))&&(p=p.replace("_normal.","_400x400.")),{avatar:p,banner:x,bio:g,headerItems:f,name:h,self:u,url:c,userName:b}}catch{return null}},me=n=>new Promise(t=>setTimeout(t,n)),ue=async(n,t=90)=>{const s=new Set;let i=0,m=0;for(let l=0;l<t&&!n.current;l++){document.documentElement.scrollTo(0,document.documentElement.scrollTop+window.innerHeight+100),await me(500);const d=document.documentElement.scrollTop;if(d===m?i++:i=0,i>=10)break;m=d,document.querySelectorAll('[data-testid="tweet"]').forEach(u=>{var h;try{if(u.querySelector('div[class="css-175oi2r r-1habvwh r-1wbh5a2 r-1777fci"]'))return;const g=u.querySelector("time"),c=g&&(g==null?void 0:g.getAttribute("datetime")),f=g&&((h=g.parentElement)==null?void 0:h.getAttribute("href")),p=u.querySelectorAll('[data-testid="tweetText"]'),w=p.length>0&&p[0];if(!g||!w)return;let v="";w.childNodes.forEach(y=>{v+=y instanceof HTMLImageElement?(y==null?void 0:y.alt)||"":y.textContent||""}),v&&f&&c&&s.add(JSON.stringify({text:v,time:c,url:f}))}catch{}})}return Array.from(s).map(l=>JSON.parse(l))};async function ge(n,t){return(await C.post("/doppelgainger/build",{profileDetails:n,tweets:Array.from(t)})).data}async function xe(n,t){const o=new URLSearchParams(window.location.search).get("doppelgaingerID");return(await C.post("/doppelgainger/v2/build",{doppelgaingerId:o,profileDetails:n,tweets:Array.from(t)})).data}function he(){if(document.getElementById("merlin-modal"))return;const n=document.createElement("merlin-component");n.id="merlin-modal",n.className="merlin modal";const t=n.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=`${z}
		:host(.merlin .modal) {
		all: initial; /* 1st rule so subsequent properties are reset. */
		position: relative;
		display: block;
		margin: 0;
		padding: 0;
		align-self : start;
		box-sizing: border-box;
		z-index: 1000;
		}
		. modal {
		all: initial; /* 1st rule so subsequent properties are reset. */
		position: relative;
		margin: 0;
		padding: 0;
		box-sizing: border-box;
		}
		. modal ::-webkit-scrollbar {
		display: none;
		-ms-overflow-style: none;
		scrollbar-width: none;
		}
		`;const o=document.createElement("div");o.id="modalRoot",o.className="reactAppRoot modal-root",t==null||t.appendChild(r),t==null||t.appendChild(o),document.documentElement.prepend(n)}function fe(){const[n,t]=j.useState(null),[r,o]=j.useState(!1),[a,s]=j.useState(!1),i=j.useRef(!1),d=!!new URLSearchParams(window.location.search).get("doppelgaingerID"),x=ce();let u=null;const h=async()=>{t("INPROGRESS");try{const c=pe();if(!c)throw new Error;const f=await ue(i,d?120:90);if(i.current)return i.current=!1,t(null);if(f.length<20)return t("INSUFFICIENT_DATA");u=setTimeout(()=>{t("SUCCESS")},12e3);const p=d?await xe(c,f):await ge(c,f),{data:w,status:v}=p;d?window.open(`${S.DOMAIN}/bio`):(window.open(`${S.DOMAIN}/doppelgainger/${x}`),o(!0),q(w.doppelgainger)),t(null)}catch(c){u&&clearTimeout(u),t("ERROR"),i.current=!1,console.error(c)}finally{document.documentElement.scrollTo(0,0)}};async function b(){s(!0);try{const c=await ie(x);c?(o(!0),Q(`${S.DOMAIN}/doppelgainger/${x}`),q(c)):(he(),t("CONFIRMATION"))}catch(c){console.error(c)}finally{s(!1)}}const g=V();return I.useEffect(()=>{t(null)},[g]),I.useEffect(()=>{new URLSearchParams(window.location.search).get("triggerDoppelgainger")&&b()},[]),I.useEffect(()=>{(async()=>{const c=await le(x);o(c)})()},[]),r?e.jsx(_,{children:e.jsx(A,{children:e.jsx(T,{children:e.jsx(D,{websiteOverride:!0,children:e.jsx(ne,{twitterUsername:x})})})})}):e.jsx(_,{children:e.jsx(A,{children:e.jsx(T,{children:e.jsxs(D,{websiteOverride:!0,children:[n&&U.createPortal(e.jsx(se,{profileName:de(),buildDoppelgainger:h,modalStatus:n,setModalStatus:t,abortRef:i}),document.getElementById("merlin-modal").shadowRoot.getElementById("modalRoot")),e.jsx(re,{loading:!!n||a,handleClick:b})]})})})})}const P=async n=>{const t=document.createElement("merlin-component");t.id="merlin-doppelgainger",t.className="merlin doppelgainger";const r=t.attachShadow({mode:"open"}),o=document.createElement("style");o.textContent=`${z}
    :host(.merlin.doppelgainger) {
      all: initial; /* 1st rule so subsequent properties are reset. */
      position: absolute;
      display: block;
      right:0;
      top: 100%;
      margin: 0;
      padding: 0;
      align-self : start;
      box-sizing: border-box;
      z-index: 1000;
    }
    .doppelgainger {
      all: initial; /* 1st rule so subsequent properties are reset. */
      position: relative;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    .doppelgainger ::-webkit-scrollbar {
      display: none;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    `,r==null||r.appendChild(o);const a=document.createElement("div");a.id="reactAppRoot",a.className="reactAppRoot doppelgainger",r==null||r.appendChild(a),n==null||n.appendChild(t),F(a).render(e.jsx(fe,{}))},be=async()=>{var s,i,m,l;const n=await H.fetchQuery(G);if(!((i=(s=n==null?void 0:n.misc)==null?void 0:s.doppelgainger)!=null&&i.v2Visible))return;const t=(l=(m=n==null?void 0:n.misc)==null?void 0:m.doppelgainger)==null?void 0:l.blacklistedSlugs,r=await ae();if(r&&!r.querySelector("merlin-component")){if(!M(t))return;P(r)}const o=new MutationObserver(B(()=>{var u,h;const d=((u=document.querySelector('[data-testid="placementTracking"]'))==null?void 0:u.parentElement)||((h=document.querySelector('[data-testid="editProfileButton"]'))==null?void 0:h.parentElement),x=document.querySelector(".merlin.modal");if(!(d!=null&&d.querySelector("merlin-component"))&&!x){if(!M(t))return;P(d)}},300)),a={childList:!0,subtree:!0};o.observe(document.body,a)};be();
