import{r as E,g as mr,b as he,j as n,c as zt,d as fr,E as hr,e as gr,a as Et,f as vr,R as _e,h as De}from"./constants-e5712b98.js";import{c as ge}from"./font-e4ec73e1.js";import{B as $,o as xr,s as Ye,e as je,u as Ie,a as yr,c as It}from"./button-e2ac6183.js";import{c as br,A as nt,C as at,R as ot,a as st,b as wr,d as jr,u as Sr}from"./index-f00bab01.js";import{F as We}from"./foyerLogo-8a2dc06a.js";import{C as Ut}from"./configContext-ec633c64.js";import{M as Vt}from"./messageContext-f7b272bf.js";import{T as it}from"./themeContext-b5ecfc73.js";import{o as Le,g as qt,i as lt,q as Nr,Q as Cr}from"./index-5ad58ea9.js";import{P as Yt}from"./useMedia-c48a250e.js";import{S as me,I as Ar,T as ct,a as Tt,f as Er,l as Ir}from"./textarea-660024e1.js";import{B as Je,A as qr,a as Tr}from"./avatar-1c1cd4d0.js";import{u as Or,t as Rr,C as de,a as Pe,b as Qt,c as Mr,d as Be}from"./zod-24415ea2.js";import{S as Fe,I as Kt}from"./Combination-0edb6dd9.js";import{f as _}from"./analytics-e24f0cc0.js";import{S as H,F as Lr,a as Qe,b as Ke,c as Xe,d as Pr,e as Br,f as kr,g as $r,h as Ot,i as Rt,j as Mt,u as _r}from"./select-cbc93c8d.js";import{u as Fr}from"./useSSE-d3d13984.js";import{C as Gr}from"./index-4c228ee2.js";import{F as Dr}from"./index-39819034.js";import{u as He}from"./i18n-6c9556b7.js";import{I as Wr}from"./IconChevronUp-9fbeda14.js";import{I as Hr}from"./IconChevronDown-b03cde4d.js";import{I as zr}from"./IconCheck-f452d2aa.js";import{I as Ur}from"./IconCopy-a5a1449e.js";import{I as Vr}from"./IconRefresh-ff2179ff.js";import{a as Yr,I as et}from"./IconSend-07f8814c.js";import{I as Qr}from"./IconChevronRight-89acbc25.js";import{I as Ze}from"./IconX-5b78e9ec.js";import{c as Kr}from"./createReactComponent-85aa5d18.js";import{A as Xt}from"./index-c40a070c.js";import{m as qe}from"./motion-ec7ce7e0.js";import{v as fe}from"./v4-4a60fe23.js";import{g as Xr,s as Zr}from"./backend-f1dada26.js";import{c as ue}from"./index-0c67d257.js";import"./index-fe9d96fe.js";import"./index-9ef95a97.js";import"./index-3da7154a.js";import"./index-f8d4d59a.js";import"./createLucideIcon-b09954cb.js";var Jr=Kr("square","IconSquare",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}]]),Lt=function(t){return t.reduce(function(r,a){var s=a[0],o=a[1];return r[s]=o,r},{})},Pt=typeof window<"u"&&window.document&&window.document.createElement?E.useLayoutEffect:E.useEffect,D="top",Y="bottom",Q="right",W="left",ut="auto",Te=[D,Y,Q,W],ve="start",Ae="end",en="clippingParents",Zt="viewport",Se="popper",tn="reference",Bt=Te.reduce(function(e,t){return e.concat([t+"-"+ve,t+"-"+Ae])},[]),Jt=[].concat(Te,[ut]).reduce(function(e,t){return e.concat([t,t+"-"+ve,t+"-"+Ae])},[]),rn="beforeRead",nn="read",an="afterRead",on="beforeMain",sn="main",ln="afterMain",cn="beforeWrite",un="write",pn="afterWrite",dn=[rn,nn,an,on,sn,ln,cn,un,pn];function J(e){return e?(e.nodeName||"").toLowerCase():null}function z(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function pe(e){var t=z(e).Element;return e instanceof t||e instanceof Element}function V(e){var t=z(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function pt(e){if(typeof ShadowRoot>"u")return!1;var t=z(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}function mn(e){var t=e.state;Object.keys(t.elements).forEach(function(r){var a=t.styles[r]||{},s=t.attributes[r]||{},o=t.elements[r];!V(o)||!J(o)||(Object.assign(o.style,a),Object.keys(s).forEach(function(i){var u=s[i];u===!1?o.removeAttribute(i):o.setAttribute(i,u===!0?"":u)}))})}function fn(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow),function(){Object.keys(t.elements).forEach(function(a){var s=t.elements[a],o=t.attributes[a]||{},i=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:r[a]),u=i.reduce(function(c,h){return c[h]="",c},{});!V(s)||!J(s)||(Object.assign(s.style,u),Object.keys(o).forEach(function(c){s.removeAttribute(c)}))})}}const hn={name:"applyStyles",enabled:!0,phase:"write",fn:mn,effect:fn,requires:["computeStyles"]};function Z(e){return e.split("-")[0]}var ce=Math.max,Ge=Math.min,xe=Math.round;function tt(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function er(){return!/^((?!chrome|android).)*safari/i.test(tt())}function ye(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=e.getBoundingClientRect(),s=1,o=1;t&&V(e)&&(s=e.offsetWidth>0&&xe(a.width)/e.offsetWidth||1,o=e.offsetHeight>0&&xe(a.height)/e.offsetHeight||1);var i=pe(e)?z(e):window,u=i.visualViewport,c=!er()&&r,h=(a.left+(c&&u?u.offsetLeft:0))/s,p=(a.top+(c&&u?u.offsetTop:0))/o,l=a.width/s,m=a.height/o;return{width:l,height:m,top:p,right:h+l,bottom:p+m,left:h,x:h,y:p}}function dt(e){var t=ye(e),r=e.offsetWidth,a=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:a}}function tr(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&pt(r)){var a=t;do{if(a&&e.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function ne(e){return z(e).getComputedStyle(e)}function gn(e){return["table","td","th"].indexOf(J(e))>=0}function ie(e){return((pe(e)?e.ownerDocument:e.document)||window.document).documentElement}function ze(e){return J(e)==="html"?e:e.assignedSlot||e.parentNode||(pt(e)?e.host:null)||ie(e)}function kt(e){return!V(e)||ne(e).position==="fixed"?null:e.offsetParent}function vn(e){var t=/firefox/i.test(tt()),r=/Trident/i.test(tt());if(r&&V(e)){var a=ne(e);if(a.position==="fixed")return null}var s=ze(e);for(pt(s)&&(s=s.host);V(s)&&["html","body"].indexOf(J(s))<0;){var o=ne(s);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||t&&o.willChange==="filter"||t&&o.filter&&o.filter!=="none")return s;s=s.parentNode}return null}function Oe(e){for(var t=z(e),r=kt(e);r&&gn(r)&&ne(r).position==="static";)r=kt(r);return r&&(J(r)==="html"||J(r)==="body"&&ne(r).position==="static")?t:r||vn(e)||t}function mt(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Ne(e,t,r){return ce(e,Ge(t,r))}function xn(e,t,r){var a=Ne(e,t,r);return a>r?r:a}function rr(){return{top:0,right:0,bottom:0,left:0}}function nr(e){return Object.assign({},rr(),e)}function ar(e,t){return t.reduce(function(r,a){return r[a]=e,r},{})}var yn=function(t,r){return t=typeof t=="function"?t(Object.assign({},r.rects,{placement:r.placement})):t,nr(typeof t!="number"?t:ar(t,Te))};function bn(e){var t,r=e.state,a=e.name,s=e.options,o=r.elements.arrow,i=r.modifiersData.popperOffsets,u=Z(r.placement),c=mt(u),h=[W,Q].indexOf(u)>=0,p=h?"height":"width";if(!(!o||!i)){var l=yn(s.padding,r),m=dt(o),f=c==="y"?D:W,C=c==="y"?Y:Q,y=r.rects.reference[p]+r.rects.reference[c]-i[c]-r.rects.popper[p],w=i[c]-r.rects.reference[c],A=Oe(o),q=A?c==="y"?A.clientHeight||0:A.clientWidth||0:0,R=y/2-w/2,b=l[f],d=q-m[p]-l[C],x=q/2-m[p]/2+R,j=Ne(b,x,d),S=c;r.modifiersData[a]=(t={},t[S]=j,t.centerOffset=j-x,t)}}function wn(e){var t=e.state,r=e.options,a=r.element,s=a===void 0?"[data-popper-arrow]":a;s!=null&&(typeof s=="string"&&(s=t.elements.popper.querySelector(s),!s)||tr(t.elements.popper,s)&&(t.elements.arrow=s))}const jn={name:"arrow",enabled:!0,phase:"main",fn:bn,effect:wn,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function be(e){return e.split("-")[1]}var Sn={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Nn(e,t){var r=e.x,a=e.y,s=t.devicePixelRatio||1;return{x:xe(r*s)/s||0,y:xe(a*s)/s||0}}function $t(e){var t,r=e.popper,a=e.popperRect,s=e.placement,o=e.variation,i=e.offsets,u=e.position,c=e.gpuAcceleration,h=e.adaptive,p=e.roundOffsets,l=e.isFixed,m=i.x,f=m===void 0?0:m,C=i.y,y=C===void 0?0:C,w=typeof p=="function"?p({x:f,y}):{x:f,y};f=w.x,y=w.y;var A=i.hasOwnProperty("x"),q=i.hasOwnProperty("y"),R=W,b=D,d=window;if(h){var x=Oe(r),j="clientHeight",S="clientWidth";if(x===z(r)&&(x=ie(r),ne(x).position!=="static"&&u==="absolute"&&(j="scrollHeight",S="scrollWidth")),x=x,s===D||(s===W||s===Q)&&o===Ae){b=Y;var g=l&&x===d&&d.visualViewport?d.visualViewport.height:x[j];y-=g-a.height,y*=c?1:-1}if(s===W||(s===D||s===Y)&&o===Ae){R=Q;var v=l&&x===d&&d.visualViewport?d.visualViewport.width:x[S];f-=v-a.width,f*=c?1:-1}}var N=Object.assign({position:u},h&&Sn),T=p===!0?Nn({x:f,y},z(r)):{x:f,y};if(f=T.x,y=T.y,c){var I;return Object.assign({},N,(I={},I[b]=q?"0":"",I[R]=A?"0":"",I.transform=(d.devicePixelRatio||1)<=1?"translate("+f+"px, "+y+"px)":"translate3d("+f+"px, "+y+"px, 0)",I))}return Object.assign({},N,(t={},t[b]=q?y+"px":"",t[R]=A?f+"px":"",t.transform="",t))}function Cn(e){var t=e.state,r=e.options,a=r.gpuAcceleration,s=a===void 0?!0:a,o=r.adaptive,i=o===void 0?!0:o,u=r.roundOffsets,c=u===void 0?!0:u,h={placement:Z(t.placement),variation:be(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,$t(Object.assign({},h,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:i,roundOffsets:c})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,$t(Object.assign({},h,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const An={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Cn,data:{}};var Me={passive:!0};function En(e){var t=e.state,r=e.instance,a=e.options,s=a.scroll,o=s===void 0?!0:s,i=a.resize,u=i===void 0?!0:i,c=z(t.elements.popper),h=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&h.forEach(function(p){p.addEventListener("scroll",r.update,Me)}),u&&c.addEventListener("resize",r.update,Me),function(){o&&h.forEach(function(p){p.removeEventListener("scroll",r.update,Me)}),u&&c.removeEventListener("resize",r.update,Me)}}const In={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:En,data:{}};var qn={left:"right",right:"left",bottom:"top",top:"bottom"};function ke(e){return e.replace(/left|right|bottom|top/g,function(t){return qn[t]})}var Tn={start:"end",end:"start"};function _t(e){return e.replace(/start|end/g,function(t){return Tn[t]})}function ft(e){var t=z(e),r=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:r,scrollTop:a}}function ht(e){return ye(ie(e)).left+ft(e).scrollLeft}function On(e,t){var r=z(e),a=ie(e),s=r.visualViewport,o=a.clientWidth,i=a.clientHeight,u=0,c=0;if(s){o=s.width,i=s.height;var h=er();(h||!h&&t==="fixed")&&(u=s.offsetLeft,c=s.offsetTop)}return{width:o,height:i,x:u+ht(e),y:c}}function Rn(e){var t,r=ie(e),a=ft(e),s=(t=e.ownerDocument)==null?void 0:t.body,o=ce(r.scrollWidth,r.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),i=ce(r.scrollHeight,r.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),u=-a.scrollLeft+ht(e),c=-a.scrollTop;return ne(s||r).direction==="rtl"&&(u+=ce(r.clientWidth,s?s.clientWidth:0)-o),{width:o,height:i,x:u,y:c}}function gt(e){var t=ne(e),r=t.overflow,a=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+s+a)}function or(e){return["html","body","#document"].indexOf(J(e))>=0?e.ownerDocument.body:V(e)&&gt(e)?e:or(ze(e))}function Ce(e,t){var r;t===void 0&&(t=[]);var a=or(e),s=a===((r=e.ownerDocument)==null?void 0:r.body),o=z(a),i=s?[o].concat(o.visualViewport||[],gt(a)?a:[]):a,u=t.concat(i);return s?u:u.concat(Ce(ze(i)))}function rt(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Mn(e,t){var r=ye(e,!1,t==="fixed");return r.top=r.top+e.clientTop,r.left=r.left+e.clientLeft,r.bottom=r.top+e.clientHeight,r.right=r.left+e.clientWidth,r.width=e.clientWidth,r.height=e.clientHeight,r.x=r.left,r.y=r.top,r}function Ft(e,t,r){return t===Zt?rt(On(e,r)):pe(t)?Mn(t,r):rt(Rn(ie(e)))}function Ln(e){var t=Ce(ze(e)),r=["absolute","fixed"].indexOf(ne(e).position)>=0,a=r&&V(e)?Oe(e):e;return pe(a)?t.filter(function(s){return pe(s)&&tr(s,a)&&J(s)!=="body"}):[]}function Pn(e,t,r,a){var s=t==="clippingParents"?Ln(e):[].concat(t),o=[].concat(s,[r]),i=o[0],u=o.reduce(function(c,h){var p=Ft(e,h,a);return c.top=ce(p.top,c.top),c.right=Ge(p.right,c.right),c.bottom=Ge(p.bottom,c.bottom),c.left=ce(p.left,c.left),c},Ft(e,i,a));return u.width=u.right-u.left,u.height=u.bottom-u.top,u.x=u.left,u.y=u.top,u}function sr(e){var t=e.reference,r=e.element,a=e.placement,s=a?Z(a):null,o=a?be(a):null,i=t.x+t.width/2-r.width/2,u=t.y+t.height/2-r.height/2,c;switch(s){case D:c={x:i,y:t.y-r.height};break;case Y:c={x:i,y:t.y+t.height};break;case Q:c={x:t.x+t.width,y:u};break;case W:c={x:t.x-r.width,y:u};break;default:c={x:t.x,y:t.y}}var h=s?mt(s):null;if(h!=null){var p=h==="y"?"height":"width";switch(o){case ve:c[h]=c[h]-(t[p]/2-r[p]/2);break;case Ae:c[h]=c[h]+(t[p]/2-r[p]/2);break}}return c}function Ee(e,t){t===void 0&&(t={});var r=t,a=r.placement,s=a===void 0?e.placement:a,o=r.strategy,i=o===void 0?e.strategy:o,u=r.boundary,c=u===void 0?en:u,h=r.rootBoundary,p=h===void 0?Zt:h,l=r.elementContext,m=l===void 0?Se:l,f=r.altBoundary,C=f===void 0?!1:f,y=r.padding,w=y===void 0?0:y,A=nr(typeof w!="number"?w:ar(w,Te)),q=m===Se?tn:Se,R=e.rects.popper,b=e.elements[C?q:m],d=Pn(pe(b)?b:b.contextElement||ie(e.elements.popper),c,p,i),x=ye(e.elements.reference),j=sr({reference:x,element:R,strategy:"absolute",placement:s}),S=rt(Object.assign({},R,j)),g=m===Se?S:x,v={top:d.top-g.top+A.top,bottom:g.bottom-d.bottom+A.bottom,left:d.left-g.left+A.left,right:g.right-d.right+A.right},N=e.modifiersData.offset;if(m===Se&&N){var T=N[s];Object.keys(v).forEach(function(I){var P=[Q,Y].indexOf(I)>=0?1:-1,L=[D,Y].indexOf(I)>=0?"y":"x";v[I]+=T[L]*P})}return v}function Bn(e,t){t===void 0&&(t={});var r=t,a=r.placement,s=r.boundary,o=r.rootBoundary,i=r.padding,u=r.flipVariations,c=r.allowedAutoPlacements,h=c===void 0?Jt:c,p=be(a),l=p?u?Bt:Bt.filter(function(C){return be(C)===p}):Te,m=l.filter(function(C){return h.indexOf(C)>=0});m.length===0&&(m=l);var f=m.reduce(function(C,y){return C[y]=Ee(e,{placement:y,boundary:s,rootBoundary:o,padding:i})[Z(y)],C},{});return Object.keys(f).sort(function(C,y){return f[C]-f[y]})}function kn(e){if(Z(e)===ut)return[];var t=ke(e);return[_t(e),t,_t(t)]}function $n(e){var t=e.state,r=e.options,a=e.name;if(!t.modifiersData[a]._skip){for(var s=r.mainAxis,o=s===void 0?!0:s,i=r.altAxis,u=i===void 0?!0:i,c=r.fallbackPlacements,h=r.padding,p=r.boundary,l=r.rootBoundary,m=r.altBoundary,f=r.flipVariations,C=f===void 0?!0:f,y=r.allowedAutoPlacements,w=t.options.placement,A=Z(w),q=A===w,R=c||(q||!C?[ke(w)]:kn(w)),b=[w].concat(R).reduce(function(X,U){return X.concat(Z(U)===ut?Bn(t,{placement:U,boundary:p,rootBoundary:l,padding:h,flipVariations:C,allowedAutoPlacements:y}):U)},[]),d=t.rects.reference,x=t.rects.popper,j=new Map,S=!0,g=b[0],v=0;v<b.length;v++){var N=b[v],T=Z(N),I=be(N)===ve,P=[D,Y].indexOf(T)>=0,L=P?"width":"height",M=Ee(t,{placement:N,boundary:p,rootBoundary:l,altBoundary:m,padding:h}),B=P?I?Q:W:I?Y:D;d[L]>x[L]&&(B=ke(B));var O=ke(B),k=[];if(o&&k.push(M[T]<=0),u&&k.push(M[B]<=0,M[O]<=0),k.every(function(X){return X})){g=N,S=!1;break}j.set(N,k)}if(S)for(var F=C?3:1,G=function(U){var te=b.find(function(oe){var K=j.get(oe);if(K)return K.slice(0,U).every(function(re){return re})});if(te)return g=te,"break"},ee=F;ee>0;ee--){var ae=G(ee);if(ae==="break")break}t.placement!==g&&(t.modifiersData[a]._skip=!0,t.placement=g,t.reset=!0)}}const _n={name:"flip",enabled:!0,phase:"main",fn:$n,requiresIfExists:["offset"],data:{_skip:!1}};function Gt(e,t,r){return r===void 0&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function Dt(e){return[D,Q,Y,W].some(function(t){return e[t]>=0})}function Fn(e){var t=e.state,r=e.name,a=t.rects.reference,s=t.rects.popper,o=t.modifiersData.preventOverflow,i=Ee(t,{elementContext:"reference"}),u=Ee(t,{altBoundary:!0}),c=Gt(i,a),h=Gt(u,s,o),p=Dt(c),l=Dt(h);t.modifiersData[r]={referenceClippingOffsets:c,popperEscapeOffsets:h,isReferenceHidden:p,hasPopperEscaped:l},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":p,"data-popper-escaped":l})}const Gn={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Fn};function Dn(e,t,r){var a=Z(e),s=[W,D].indexOf(a)>=0?-1:1,o=typeof r=="function"?r(Object.assign({},t,{placement:e})):r,i=o[0],u=o[1];return i=i||0,u=(u||0)*s,[W,Q].indexOf(a)>=0?{x:u,y:i}:{x:i,y:u}}function Wn(e){var t=e.state,r=e.options,a=e.name,s=r.offset,o=s===void 0?[0,0]:s,i=Jt.reduce(function(p,l){return p[l]=Dn(l,t.rects,o),p},{}),u=i[t.placement],c=u.x,h=u.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=h),t.modifiersData[a]=i}const Hn={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Wn};function zn(e){var t=e.state,r=e.name;t.modifiersData[r]=sr({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const Un={name:"popperOffsets",enabled:!0,phase:"read",fn:zn,data:{}};function Vn(e){return e==="x"?"y":"x"}function Yn(e){var t=e.state,r=e.options,a=e.name,s=r.mainAxis,o=s===void 0?!0:s,i=r.altAxis,u=i===void 0?!1:i,c=r.boundary,h=r.rootBoundary,p=r.altBoundary,l=r.padding,m=r.tether,f=m===void 0?!0:m,C=r.tetherOffset,y=C===void 0?0:C,w=Ee(t,{boundary:c,rootBoundary:h,padding:l,altBoundary:p}),A=Z(t.placement),q=be(t.placement),R=!q,b=mt(A),d=Vn(b),x=t.modifiersData.popperOffsets,j=t.rects.reference,S=t.rects.popper,g=typeof y=="function"?y(Object.assign({},t.rects,{placement:t.placement})):y,v=typeof g=="number"?{mainAxis:g,altAxis:g}:Object.assign({mainAxis:0,altAxis:0},g),N=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,T={x:0,y:0};if(x){if(o){var I,P=b==="y"?D:W,L=b==="y"?Y:Q,M=b==="y"?"height":"width",B=x[b],O=B+w[P],k=B-w[L],F=f?-S[M]/2:0,G=q===ve?j[M]:S[M],ee=q===ve?-S[M]:-j[M],ae=t.elements.arrow,X=f&&ae?dt(ae):{width:0,height:0},U=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:rr(),te=U[P],oe=U[L],K=Ne(0,j[M],X[M]),re=R?j[M]/2-F-K-te-v.mainAxis:G-K-te-v.mainAxis,we=R?-j[M]/2+F+K+oe+v.mainAxis:ee+K+oe+v.mainAxis,Ue=t.elements.arrow&&Oe(t.elements.arrow),lr=Ue?b==="y"?Ue.clientTop||0:Ue.clientLeft||0:0,xt=(I=N==null?void 0:N[b])!=null?I:0,cr=B+re-xt-lr,ur=B+we-xt,yt=Ne(f?Ge(O,cr):O,B,f?ce(k,ur):k);x[b]=yt,T[b]=yt-B}if(u){var bt,pr=b==="x"?D:W,dr=b==="x"?Y:Q,le=x[d],Re=d==="y"?"height":"width",wt=le+w[pr],jt=le-w[dr],Ve=[D,W].indexOf(A)!==-1,St=(bt=N==null?void 0:N[d])!=null?bt:0,Nt=Ve?wt:le-j[Re]-S[Re]-St+v.altAxis,Ct=Ve?le+j[Re]+S[Re]-St-v.altAxis:jt,At=f&&Ve?xn(Nt,le,Ct):Ne(f?Nt:wt,le,f?Ct:jt);x[d]=At,T[d]=At-le}t.modifiersData[a]=T}}const Qn={name:"preventOverflow",enabled:!0,phase:"main",fn:Yn,requiresIfExists:["offset"]};function Kn(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Xn(e){return e===z(e)||!V(e)?ft(e):Kn(e)}function Zn(e){var t=e.getBoundingClientRect(),r=xe(t.width)/e.offsetWidth||1,a=xe(t.height)/e.offsetHeight||1;return r!==1||a!==1}function Jn(e,t,r){r===void 0&&(r=!1);var a=V(t),s=V(t)&&Zn(t),o=ie(t),i=ye(e,s,r),u={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(a||!a&&!r)&&((J(t)!=="body"||gt(o))&&(u=Xn(t)),V(t)?(c=ye(t,!0),c.x+=t.clientLeft,c.y+=t.clientTop):o&&(c.x=ht(o))),{x:i.left+u.scrollLeft-c.x,y:i.top+u.scrollTop-c.y,width:i.width,height:i.height}}function ea(e){var t=new Map,r=new Set,a=[];e.forEach(function(o){t.set(o.name,o)});function s(o){r.add(o.name);var i=[].concat(o.requires||[],o.requiresIfExists||[]);i.forEach(function(u){if(!r.has(u)){var c=t.get(u);c&&s(c)}}),a.push(o)}return e.forEach(function(o){r.has(o.name)||s(o)}),a}function ta(e){var t=ea(e);return dn.reduce(function(r,a){return r.concat(t.filter(function(s){return s.phase===a}))},[])}function ra(e){var t;return function(){return t||(t=new Promise(function(r){Promise.resolve().then(function(){t=void 0,r(e())})})),t}}function na(e){var t=e.reduce(function(r,a){var s=r[a.name];return r[a.name]=s?Object.assign({},s,a,{options:Object.assign({},s.options,a.options),data:Object.assign({},s.data,a.data)}):a,r},{});return Object.keys(t).map(function(r){return t[r]})}var Wt={placement:"bottom",modifiers:[],strategy:"absolute"};function Ht(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function aa(e){e===void 0&&(e={});var t=e,r=t.defaultModifiers,a=r===void 0?[]:r,s=t.defaultOptions,o=s===void 0?Wt:s;return function(u,c,h){h===void 0&&(h=o);var p={placement:"bottom",orderedModifiers:[],options:Object.assign({},Wt,o),modifiersData:{},elements:{reference:u,popper:c},attributes:{},styles:{}},l=[],m=!1,f={state:p,setOptions:function(A){var q=typeof A=="function"?A(p.options):A;y(),p.options=Object.assign({},o,p.options,q),p.scrollParents={reference:pe(u)?Ce(u):u.contextElement?Ce(u.contextElement):[],popper:Ce(c)};var R=ta(na([].concat(a,p.options.modifiers)));return p.orderedModifiers=R.filter(function(b){return b.enabled}),C(),f.update()},forceUpdate:function(){if(!m){var A=p.elements,q=A.reference,R=A.popper;if(Ht(q,R)){p.rects={reference:Jn(q,Oe(R),p.options.strategy==="fixed"),popper:dt(R)},p.reset=!1,p.placement=p.options.placement,p.orderedModifiers.forEach(function(v){return p.modifiersData[v.name]=Object.assign({},v.data)});for(var b=0;b<p.orderedModifiers.length;b++){if(p.reset===!0){p.reset=!1,b=-1;continue}var d=p.orderedModifiers[b],x=d.fn,j=d.options,S=j===void 0?{}:j,g=d.name;typeof x=="function"&&(p=x({state:p,options:S,name:g,instance:f})||p)}}}},update:ra(function(){return new Promise(function(w){f.forceUpdate(),w(p)})}),destroy:function(){y(),m=!0}};if(!Ht(u,c))return f;f.setOptions(h).then(function(w){!m&&h.onFirstUpdate&&h.onFirstUpdate(w)});function C(){p.orderedModifiers.forEach(function(w){var A=w.name,q=w.options,R=q===void 0?{}:q,b=w.effect;if(typeof b=="function"){var d=b({state:p,name:A,instance:f,options:R}),x=function(){};l.push(d||x)}})}function y(){l.forEach(function(w){return w()}),l=[]}return f}}var oa=[In,Un,An,hn,Hn,_n,Qn,jn,Gn],sa=aa({defaultModifiers:oa}),ia=typeof Element<"u",la=typeof Map=="function",ca=typeof Set=="function",ua=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function $e(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,a,s;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(a=r;a--!==0;)if(!$e(e[a],t[a]))return!1;return!0}var o;if(la&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(o=e.entries();!(a=o.next()).done;)if(!t.has(a.value[0]))return!1;for(o=e.entries();!(a=o.next()).done;)if(!$e(a.value[1],t.get(a.value[0])))return!1;return!0}if(ca&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(o=e.entries();!(a=o.next()).done;)if(!t.has(a.value[0]))return!1;return!0}if(ua&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(a=r;a--!==0;)if(e[a]!==t[a])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(a=r;a--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[a]))return!1;if(ia&&e instanceof Element)return!1;for(a=r;a--!==0;)if(!((s[a]==="_owner"||s[a]==="__v"||s[a]==="__o")&&e.$$typeof)&&!$e(e[s[a]],t[s[a]]))return!1;return!0}return e!==e&&t!==t}var pa=function(t,r){try{return $e(t,r)}catch(a){if((a.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw a}};const da=mr(pa);var ma=[],ir=function(t,r,a){a===void 0&&(a={});var s=E.useRef(null),o={onFirstUpdate:a.onFirstUpdate,placement:a.placement||"bottom",strategy:a.strategy||"absolute",modifiers:a.modifiers||ma},i=E.useState({styles:{popper:{position:o.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),u=i[0],c=i[1],h=E.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(f){var C=f.state,y=Object.keys(C.elements);he.flushSync(function(){c({styles:Lt(y.map(function(w){return[w,C.styles[w]||{}]})),attributes:Lt(y.map(function(w){return[w,C.attributes[w]]}))})})},requires:["computeStyles"]}},[]),p=E.useMemo(function(){var m={onFirstUpdate:o.onFirstUpdate,placement:o.placement,strategy:o.strategy,modifiers:[].concat(o.modifiers,[h,{name:"applyStyles",enabled:!1}])};return da(s.current,m)?s.current||m:(s.current=m,m)},[o.onFirstUpdate,o.placement,o.strategy,o.modifiers,h]),l=E.useRef();return Pt(function(){l.current&&l.current.setOptions(p)},[p]),Pt(function(){if(!(t==null||r==null)){var m=a.createPopper||sa,f=m(t,r,p);return l.current=f,function(){f.destroy(),l.current=null}}},[t,r,a.createPopper]),{state:l.current?l.current.state:null,styles:u.styles,attributes:u.attributes,update:l.current?l.current.update:null,forceUpdate:l.current?l.current.forceUpdate:null}};const se=br(e=>({quickPromptAIReply:"",setQuickPromptAIReply:t=>e({quickPromptAIReply:t}),toggleUsingAIComposeBtn:()=>e(t=>({usingAIComposeBtn:!t.usingAIComposeBtn})),usingAIComposeBtn:!1}));function fa({chat:e,handleInsert:t,handleRegenerateLastMessage:r,handleSSE:a,idx:s,isLastMessage:o,isSSESuccessOrIdle:i,mountOn:u,msg:c,requestIdHeader:h}){const{t:p}=He(),[l,m]=E.useState(!1),{...f}=E.useContext(nt);function C(A){navigator.clipboard.writeText(A),m(!0),setTimeout(()=>m(!1),1200)}const[y,w]=E.useState(!1);if(c.role=="user")return n.jsxs("div",{style:{zIndex:10+s},className:`${s===e.activeThread.length-2?"sticky top-0":""} bg-background mr-3`,id:"user-msg-container",children:[n.jsxs("div",{className:"flex items-start justify-between space-x-2 pl-2",id:`${s===e.activeThread.length-2?"user-msg-body":""}`,children:[n.jsxs("div",{className:"flex items-start space-x-2",children:[n.jsx(Je,{className:"relative -left-1",variant:"secondary",children:p("super_gmail.prompt")}),n.jsx("span",{className:`text-foreground max-w-80 my-auto text-sm font-light transition-all duration-500 ease-in-out ${y?"":"line-clamp-1"}`,children:c.content})]}),c.content.length>52&&n.jsx("span",{onClick:()=>w(!y),className:"text-ds-icon-info w-24 cursor-pointer text-sm underline",children:y?n.jsx(Wr,{size:18,color:"#9e9e9e",className:"ml-auto mr-4"}):n.jsx(Hr,{size:18,color:"#9e9e9e",className:"ml-auto mr-4"})})]},c.id),n.jsx(me,{className:"my-2"})]});if(c.role==="assistant")return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex min-h-[262px] flex-grow flex-col justify-between px-2",children:[n.jsx(Gr,{className:"!text-sm",content:c.content.trim()}),i&&n.jsxs("div",{className:"mt-2 flex items-center gap-2 bg-white py-1 text-sm",children:[n.jsx($,{className:"text-xs",onClick:()=>{_({eventName:"Insert",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/GMailMessage"}),t(e.activeThread[s].content)},children:p("super_gmail.insert")}),n.jsx("button",{type:"button",className:"bg-transparent p-1 only:rounded-md",onClick:()=>{C(c.content)},disabled:l,children:l?n.jsx(zr,{className:"plain-icon-color h-4 w-4 stroke-[1.5]"}):n.jsx(Ur,{className:"plain-icon-color h-4 w-4 stroke-[1.5]"})}),o&&n.jsx(Vr,{className:"plain-icon-color h-4 w-4 cursor-pointer stroke-[1.5]",onClick:()=>{_({eventName:"Regenerate",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),r()}}),c.totSiblings>0&&n.jsxs("div",{className:"flex items-center",children:[n.jsx("button",{type:"button",className:" group/btn bg-transparent",onClick:()=>e.switchLeft(c),disabled:c.idx===0,children:n.jsx(Yr,{className:"plain-icon-color h-4 w-4 stroke-[1.5] group-disabled/btn:opacity-50"})}),n.jsxs("span",{className:"mx-0.5 flex items-end",children:[c.idx+1,n.jsx("span",{className:"relative -top-[1px]",children:"/"}),c.totSiblings]}),n.jsx("button",{type:"button",className:" group/btn bg-transparent",onClick:()=>e.switchRight(c),disabled:c.idx===c.totSiblings-1,children:n.jsx(Qr,{className:"plain-icon-color h-4 w-4 stroke-[1.5] group-disabled/btn:opacity-50"})})]}),o&&n.jsx("div",{className:"mr-auto",children:n.jsx(Dr,{hideText:!0,queryTerms:JSON.stringify({feature:u,mountOn:u,query:e.activeThread[e.activeThread.length-2].content}),promptResult:e.activeThread[e.activeThread.length-1].content,callingSite:window.location.href,email:!f.email||f.email===""?"EMAIL_NOT_FOUND":f.email,requestId:h})})]})]}),n.jsx(me,{className:"my-2"})]});if(c.role==="system")return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex h-[262px] flex-col justify-between px-2",children:n.jsxs("div",{className:"",children:[n.jsx(H,{className:"mb-4 h-2 w-16"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx(H,{className:"h-2 w-72"}),n.jsx(H,{className:"h-2 w-32"}),n.jsx(H,{className:"h-2 w-10"}),n.jsx(H,{className:"h-2 w-16"}),n.jsx(H,{className:"h-2 w-96"}),n.jsx(H,{className:"h-2 w-72"}),n.jsx(H,{className:"h-2 w-32"}),n.jsx(H,{className:"h-2 w-10"}),n.jsx(H,{className:"h-2 w-16"}),n.jsx(H,{className:"h-2 w-96"})]}),n.jsx(H,{className:"my-1 mt-4 h-2 w-16"}),n.jsx(H,{className:"h-2 w-20"})]})}),n.jsx(me,{className:"my-2"})]})}const ha=xr({bio:Ye(),model:je(["GPT 3","GPT 4"]),name:Ye(),occupation:Ye(),outputLang:je(["english","hindi"]),outputLength:je(["short","medium","long"]),tone:je(["empathetic","optimistic","sincere","enthusiastic"]),writingStyle:je(["professional","casual","neutral"])});function ga({setCurrentMode:e}){var u,c,h,p,l;const{t}=He(),{...r}=E.useContext(nt),[a,s]=Yt({instance:new zt({area:"local"}),key:"gmailPersona"},m=>{var f;return m===void 0?{bio:"",model:`${((f=r.usageDetails)==null?void 0:f.type)=="PAID"?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"}:m}),o=Or({defaultValues:{bio:"",model:`${((u=r.usageDetails)==null?void 0:u.type)=="PAID"?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"},resolver:Rr(ha)});E.useEffect(()=>{o.reset(a)},[o,a]);function i(m){s(m),e("CHAT")}return n.jsx(de,{className:"relative mx-auto w-[502px] p-0 shadow-lg",children:n.jsxs(Pe,{className:"flex p-0",children:[n.jsxs("div",{className:"-left-1 bottom-0 top-0 flex w-12 flex-col items-end justify-between gap-2 border-r p-1 py-2",children:[n.jsx("div",{className:"flex flex-col gap-2",children:n.jsx($,{variant:"ghost",size:"icon",onClick:()=>{e("CHAT")},children:n.jsx(Ar,{})})}),n.jsx($,{variant:"ghost",size:"icon",onClick:()=>Le(fr),children:n.jsx(qr,{className:"h-6 w-6",children:n.jsx(Tr,{children:((p=(h=(c=r.name)==null?void 0:c.split(" "))==null?void 0:h.map(m=>m[0]))==null?void 0:p.join(""))??((l=r==null?void 0:r.email[0])==null?void 0:l.toUpperCase())??"U"})})})]}),n.jsxs("div",{className:"mt-3 w-full",children:[n.jsxs(Fe,{className:"h-[320px]",children:[n.jsx(Qt,{className:"p-3",children:n.jsx(Mr,{className:"text-lg",children:t("super_gmail.config")})}),n.jsx(Lr,{...o,children:n.jsx("form",{onSubmit:o.handleSubmit(i),children:n.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[n.jsx("div",{className:"",children:n.jsx(Qe,{control:o.control,name:"model",render:({field:m})=>n.jsxs(Ke,{children:[n.jsx(Xe,{children:t("super_gmail.ai_model")}),n.jsxs(Pr,{onValueChange:m.onChange,value:m.value,children:[n.jsx(Br,{className:"w-96",children:n.jsx(kr,{})}),n.jsxs($r,{children:[n.jsx(Ot,{value:"GPT 3",children:"GPT 3"}),n.jsx(Ot,{value:"GPT 4",children:"GPT 4"})]})]})]})})}),n.jsx("div",{className:"flex items-center gap-1",children:n.jsx("h3",{className:"text-md font-semibold",children:t("super_gmail.persona")})}),n.jsx("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:n.jsx(Qe,{control:o.control,name:"name",render:({field:m})=>n.jsxs(Ke,{children:[n.jsx(Xe,{children:t("super_gmail.name")}),n.jsx(Rt,{children:n.jsx(Kt,{placeholder:"Ashutosh Kumar",...m})}),n.jsx(Mt,{})]})})}),n.jsx("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:n.jsx(Qe,{control:o.control,name:"bio",render:({field:m})=>n.jsxs(Ke,{children:[n.jsx(Xe,{children:t("super_gmail.bio")}),n.jsx(Rt,{children:n.jsx(ct,{placeholder:t("super_gmail.bio_placeholder"),className:"resize-none",...m})}),n.jsx(Mt,{})]})})})]})})})]}),n.jsx(Be,{className:"flex justify-end gap-2 p-2",children:n.jsx($,{onClick:o.handleSubmit(i),children:t("super_gmail.save")})})]})]})})}const va=()=>{const{shadowRoot:e}=document.getElementById("merlin-gmail-uicomponentportal"),t=e.querySelector("[data-radix-scroll-area-viewport]");t&&setTimeout(()=>t.scrollTo({behavior:"smooth",left:0,top:t.scrollHeight}),100)};function vt({handleInsert:e,id:t,mailThread:r=[],mountOn:a,setIsVisible:s}){var S;const{t:o}=He(),{...i}=E.useContext(nt),[u,c]=E.useState("CHAT"),[h,p]=E.useState(null),l=_r(),m=se(g=>g.quickPromptAIReply),f=se(g=>g.setQuickPromptAIReply),C=Ie(),[y,w]=E.useState(""),[A]=Yt({instance:new zt({area:"local"}),key:"gmailPersona"},g=>{var v;return g===void 0?{bio:"",model:`${((v=i.usageDetails)==null?void 0:v.type)=="PAID"?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"}:g}),[q,R]=E.useState(null),{handleGMailSSE:b}=Fr(`${gr.DOMAIN}/generative/gmail`,"handleGMailSSE",{method:"POST",onClose:()=>{l.editMessageNodeById(l.getLastMessage().id,g=>{var v;return g.status="SUCCESS",g.attachments=(v=g.attachments)==null?void 0:v.filter(N=>N.type==="IMAGE"&&N.url||N.type!=="IMAGE"),g}),l.setIsPromptingAvailable(!0)},onError:g=>{var v;l.setIsPromptingAvailable(!0),console.error(g),l.deleteLastMessage(),(g==null?void 0:g.name)==="CUSTOM_ERROR"?g.type===hr.RATE_LIMITED?l.setError(((v=i.usageDetails)==null?void 0:v.type)==="PAID"?o("request_context.queries_exhausted"):o("request_context.queries_exhausted_for_today")):l.setError(g.message||o("request_context.something_wrong")):l.setError(o("request_context.something_wrong"))},onMessage:g=>{var T,I,P,L,M,B;const v=JSON.parse(g.data),N=v.data.content;((T=v==null?void 0:v.data)==null?void 0:T.eventType)==="SYSTEM"&&(v!=null&&v.data.hasOwnProperty("settings")&&(l.setChatId((P=(I=v==null?void 0:v.data)==null?void 0:I.settings)==null?void 0:P.chatId),l.editMessageNodeById(l.getLastMessage().parentId,O=>(O={...O,id:v.data.settings.userMessage.id},O)),l.editMessageNodeById(l.getLastMessage().id,O=>(O={...O,id:v.data.settings.assistantMessage.id,parentId:v.data.settings.userMessage.id},O))),v!=null&&v.data.hasOwnProperty("questions")&&l.setQuestions((L=v==null?void 0:v.data)==null?void 0:L.questions),(M=v==null?void 0:v.data)!=null&&M.metadata&&l.editMessageNodeById(l.getLastMessage().id,O=>(O={...O,metadata:{...O.metadata,...v.data.metadata}},O)),(B=v==null?void 0:v.data)!=null&&B.attachments&&l.editMessageNodeById(l.getLastMessage().id,O=>(O={...O,attachments:[...v.data.attachments]},O))),l.editMessageNodeById(l.getLastMessage().id,O=>(O.status==="LOADING"?(O.content=N,O.role="assistant",O.status="STREAMING"):O.status==="STREAMING"&&(O.content=`${O.content}${N}`),O))},onOpen:async g=>{g.ok&&g.headers.get("X-Request-Id")&&p(g.headers.get("X-Request-Id"))}}),d=(b==null?void 0:b.status)==="success"||(b==null?void 0:b.status)==="idle",x=async g=>{var T,I,P,L,M,B;l.setIsPromptingAvailable(!1),b.reset(),l.setError(null),l.setQuestions([]);const v=(T=C.details)==null?void 0:T.aiLanguage;l.appendMessageThread([{content:g,id:fe(),parentId:((I=l.activeThread[l.activeThread.length-1])==null?void 0:I.id)??"root",role:"user",status:"SUCCESS"},{content:"",id:fe(),parentId:"",role:"system",status:"LOADING"}]);const N={context:{forwarding:!1,messages:r,signature:"",thread:l.activeThread,user:(M=(L=(P=document==null?void 0:document.querySelector("div.gb_Z.gb_C a"))==null?void 0:P.getAttribute("aria-label"))==null?void 0:L.replace("Google Account: ",""))==null?void 0:M.replace(`
`,"")},gmailPersona:A,language:v,modelId:A.model??`${((B=i.usageDetails)==null?void 0:B.type)=="PAID"?"GPT 4":"GPT 3"}`,mountOn:a,query:g};l.setContext(""),b.execute(N),l.setContext(""),va()},j=async()=>{var N,T,I,P,L;l.setIsPromptingAvailable(!1);const g=(N=C.details)==null?void 0:N.aiLanguage;l.setError(null),l.insertMessageNode(l.activeThread[l.activeThread.length-2].id,{content:"",id:fe(),parentId:l.activeThread[l.activeThread.length-2].id,role:"system",status:"LOADING"});const v={context:{forwarding:!1,messages:r,signature:"",thread:l.activeThread.splice(0,l.activeThread.length-2),user:(P=(I=(T=document==null?void 0:document.querySelector("div.gb_Z.gb_C a"))==null?void 0:T.getAttribute("aria-label"))==null?void 0:I.replace("Google Account: ",""))==null?void 0:P.replace(`
`,"")},gmailPersona:A,language:g,modelId:(A==null?void 0:A.model)??`${((L=i.usageDetails)==null?void 0:L.type)=="PAID"?"GPT 4":"GPT 3"}`,mountOn:a,query:l.activeThread[l.activeThread.length-2].content};b.execute(v)};return E.useEffect(()=>{m&&i.isAuthenticated&&(x(m),f(""))},[]),E.useEffect(()=>{var v,N,T,I,P,L,M,B;q&&q.disconnect();const g=new IntersectionObserver(function(O){var k,F,G;O[0].isIntersecting?(k=document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))==null||k.querySelector(`.${t}`).querySelector("#user-msg-body").classList.add("line-clamp-1"):(G=(F=document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))==null?void 0:F.querySelector(`.${t}`))==null||G.querySelector("#user-msg-body").classList.remove("line-clamp-1")},{root:(v=document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))==null?void 0:v.querySelector(`.intersection-observer-root.${t}`),rootMargin:"0% 0% -95% 0%",threshold:[0,1]});(P=(I=(T=(N=document==null?void 0:document.getElementById("merlin-gmail-uicomponentportal"))==null?void 0:N.shadowRoot)==null?void 0:T.getElementById("reactAppRoot"))==null?void 0:I.querySelector(`.${t}`))!=null&&P.querySelector("#user-msg-body")&&(g.observe((B=(M=(L=document==null?void 0:document.getElementById("merlin-gmail-uicomponentportal"))==null?void 0:L.shadowRoot.getElementById("reactAppRoot"))==null?void 0:M.querySelector(`.${t}`))==null?void 0:B.querySelector("#user-msg-body")),R(g))},[l.activeThread.length]),i.isAuthenticated?u==="SETTINGS"?n.jsx(ga,{setCurrentMode:c}):l.activeThread.length===0?n.jsxs(de,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[n.jsx("div",{className:"bg-secondary absolute -right-3 -top-3 cursor-pointer rounded-full p-1 shadow-lg",onClick:()=>s(!1),children:n.jsx(Ze,{className:"h-4 w-4"})}),n.jsx(Pe,{className:"p-0",children:n.jsx(ct,{placeholder:o("super_gmail.draft_nice"),onChange:g=>w(g.target.value),value:y,className:"h-48 resize-none border-transparent focus-visible:border-transparent focus-visible:ring-0",onKeyUp:g=>{g.key==="Enter"&&y.trim()&&!g.shiftKey&&(x(y.trim()),w(""))}})}),n.jsxs(Be,{className:"mt-2 flex justify-between gap-2 p-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Je,{variant:"secondary",className:"cursor-pointer py-2",onClick:()=>{_({eventName:"IntroduceMyselfQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Write an email introducing myself.")},children:o("super_gmail.introduce")}),n.jsx(Je,{variant:"secondary",className:"cursor-pointer py-2",onClick:()=>{_({eventName:"ColdEmailQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Write a cold email")},children:o("super_gmail.cold_email")})]}),n.jsxs("div",{className:"flex items-center justify-center gap-2",children:[n.jsx($,{variant:"ghost",size:"icon",className:"rounded-none border-r px-1 hover:bg-transparent",onClick:()=>{y.trim()&&x(y.trim()),w("")},children:n.jsx(et,{className:"text-primary cursor-pointer"})}),n.jsx($,{variant:"ghost",size:"icon",onClick:()=>c("SETTINGS"),children:n.jsx(Tt,{className:"cursor-pointer"})})]})]})]}):n.jsx(n.Fragment,{children:n.jsxs(de,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[n.jsx("div",{className:"bg-secondary absolute -right-3 -top-3 cursor-pointer rounded-full p-1 shadow-lg",onClick:()=>s(!1),children:n.jsx(Ze,{className:"h-4 w-4"})}),n.jsx(Pe,{className:"p-0",children:n.jsx(Fe,{className:`intersection-observer-root h-[320px] ${t}`,children:n.jsxs("div",{className:"flex min-h-[320px] flex-col",children:[(S=l.activeThread)==null?void 0:S.map((g,v)=>n.jsx(fa,{msg:g,handleRegenerateLastMessage:j,chat:l,idx:v,handleInsert:e,handleSSE:b,isSSESuccessOrIdle:d,isLastMessage:l.activeThread.length-1===v&&g.role==="assistant",requestIdHeader:h,mountOn:a},g.id)),l.error&&!l.error.includes("Your queries have exhausted")&&n.jsxs("div",{className:"flex min-h-[280px] flex-grow flex-col justify-between px-2 text-red-500",children:[n.jsx("div",{className:"p-0 text-sm",children:l.error}),n.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:n.jsx($,{onClick:()=>x(l.activeThread[l.activeThread.length-1].content),children:o("super_gmail.retry")})})]}),l.error&&l.error.includes("Your queries have exhausted")&&n.jsxs("div",{className:"flex min-h-[280px] flex-grow flex-col justify-between px-2",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"flex",children:[n.jsx("img",{className:"h-8 w-8",src:qt(Er),alt:"face-in-cloud"}),n.jsx("img",{className:"h-8 w-8",src:qt(Ir),alt:"lightning"})]}),n.jsx("div",{className:"p-0 text-sm",children:o("super_gmail.out_of_queries")})]}),n.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:n.jsx($,{onClick:()=>Le(vr),children:o("super_gmail.go_pro")})})]})]})})}),n.jsxs(Be,{className:"flex justify-between gap-2 p-0 pt-1",children:[n.jsxs("div",{className:"relative flex w-full items-center",children:[n.jsx(Kt,{onChange:g=>w(g.target.value),value:y,id:"promptInput",className:"pr-8",placeholder:o("super_gmail.follow_up_prompt"),autoComplete:"off",onKeyUp:g=>{g.key==="Enter"&&d&&y.trim()&&(x(y.trim()),w(""))}}),d?n.jsx(et,{onClick:()=>{y.trim()&&d&&(x(y.trim()),w(""))},className:"text-primary bg-background absolute right-2 cursor-pointer"}):n.jsx($,{size:"icon",variant:"ghost",className:"absolute right-2 h-5 w-5 text-xs",onClick:()=>{_({eventName:"StopGenerating",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),l.getLastMessage().content==""&&l.deleteLastMessage(),b.close()},children:n.jsx(Jr,{className:"plain-icon-color h-5 w-5 animate-pulse fill-red-600 stroke-[1.5]"})}),n.jsx(Xt,{children:d&&(o("super_gmail.shorten").toLowerCase().includes(y.toLowerCase())||o("super_gmail.lengthen").toLowerCase().includes(y.toLowerCase())||o("super_gmail.improve").toLowerCase().includes(y.toLowerCase())||o("super_gmail.simplify").toLowerCase().includes(y.toLowerCase())||o("super_gmail.fix_spelling").toLowerCase().includes(y.toLowerCase()))&&n.jsx(qe.div,{initial:{opacity:0,originY:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0,originY:0,scaleY:0},className:"absolute top-10 w-4/5",children:n.jsx(de,{className:"rounded-md py-2",children:n.jsx(Fe,{className:"max-h-28 overflow-y-scroll",children:n.jsxs("div",{className:"flex w-full flex-col gap-1 text-sm",children:[o("super_gmail.shorten").toLowerCase().includes(y.toLowerCase())&&n.jsx("div",{onClick:()=>{_({eventName:"ShortenQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Shorten it to 50 words")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:o("super_gmail.shorten")}),o("super_gmail.improv").toLowerCase().includes(y.toLowerCase())&&n.jsx("span",{onClick:()=>{_({eventName:"ImproveWritingQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Improve writing")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:o("super_gmail.improve")}),o("super_gmail.simplify").toLowerCase().includes(y.toLowerCase())&&n.jsx("span",{onClick:()=>{_({eventName:"SimplifyQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Simplify the language")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:o("super_gmail.simplify")}),o("super_gmail.lengthen").toLowerCase().includes(y.toLowerCase())&&n.jsx("span",{onClick:()=>{_({eventName:"LengthenQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Make it longer and verbose")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:o("super_gmail.lengthen")}),o("super_gmail.fix_spelling").toLowerCase().includes(y.toLowerCase())&&n.jsx("span",{onClick:()=>{_({eventName:"FixSpellingGrammarQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Fix spelling & grammar")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:o("super_gmail.fix_spelling")})]})})})})})]}),n.jsx($,{variant:"ghost",size:"icon",onClick:()=>{_({eventName:"SettingsBtn",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),c("SETTINGS")},children:n.jsx(Tt,{className:"cursor-pointer"})})]})]})}):n.jsxs(de,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[n.jsx("div",{className:"bg-secondary absolute -right-3 -top-3 cursor-pointer rounded-full p-1 shadow-lg",onClick:()=>s(!1),children:n.jsx(Ze,{className:"h-4 w-4"})}),n.jsx(Qt,{className:"mb-2 p-0",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:"h-5 w-5",children:n.jsx(We,{})}),n.jsx("span",{className:"text-lg",children:o("merlin")})]})}),n.jsx(me,{}),n.jsx(Pe,{className:"px-2 py-3 text-sm",children:o("super_gmail.login")}),n.jsx(Be,{className:"flex justify-between gap-2 px-2 py-0",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx($,{onClick:()=>Le(Et),children:o("super_gmail.login2")}),n.jsx($,{variant:"ghost",onClick:()=>Le(Et),children:o("super_gmail.signup")})]})})]})}const xa=({attributes:e,handleInsert:t,id:r,setIsVisible:a,setPopperElement:s,styles:o,update:i})=>{const[u,c]=E.useState(!0),[h,p]=E.useState(!0);return E.useEffect(()=>{const l=new MutationObserver(lt(()=>{if(i&&i(),!document.querySelector(`.${r}`)){c(!1),l.disconnect();return}},100));return l.observe(document.body,{childList:!0,subtree:!0}),()=>l.disconnect()},[r,i]),E.useEffect(()=>{const l=new MutationObserver(()=>{try{document.querySelector(`.${r}`).closest(".nH").style.display==="none"?p(!1):p(!0)}catch{}});return l.observe(document.querySelector(`.${r}`).closest(".nH"),{attributeFilter:["style"],attributes:!0}),()=>l.disconnect()},[r]),u?n.jsx("div",{ref:s,style:o.popper,...e.popper,className:`mb-48 ${h?"":"hidden"}`,children:n.jsx(qe.div,{initial:{opacity:0,scale:0,y:150},animate:{opacity:1,scale:1,y:0},children:n.jsx(vt,{handleInsert:t,setIsVisible:a,mountOn:"GMAIL_COMPOSE",id:r})})}):null};function ya({id:e}){var C,y;const[t,r]=_e.useState(null),[a,s]=_e.useState(null),{attributes:o,forceUpdate:i,styles:u}=ir(t,a,{placement:"top"}),[c,h]=E.useState(!1),p=se(w=>w.usingAIComposeBtn),l=se(w=>w.toggleUsingAIComposeBtn),m=Ie(),f=w=>{try{const A=/^Subject: .*(\r?\n|\r)/,b=w.trim().replace(A,"").split(`
`).map(x=>x===""?"<div></div><br/>":`<div>${x}</div>`);document.querySelector(`.fab-writer.${e}`).closest(".nH.Hd").querySelector("[contenteditable=true]").innerHTML=b.join(`
`)+`
`+document.querySelector(`.fab-writer.${e}`).closest(".nH.Hd").querySelector("[contenteditable=true]").innerHTML;const d=w.trim().match(A);d&&(document.querySelector(`.fab-writer.${e}`).closest(".nH.Hd").querySelector("[name='subjectbox']").value=d[0]),h(!1)}catch{}};if(E.useEffect(()=>{p&&(h(!0),l())},[]),(y=(C=m.details)==null?void 0:C.gmail)!=null&&y.isEnabled)return n.jsx(at,{children:n.jsx(ot,{children:n.jsx(Ut,{children:n.jsx(st,{children:n.jsx(Vt,{children:n.jsx(it,{websiteOverride:!0,children:n.jsxs("div",{className:"flex w-full justify-center",children:[n.jsx("div",{ref:r,className:`${e}`}),c&&he.createPortal(n.jsx(xa,{setPopperElement:s,styles:u,attributes:o,setIsVisible:h,id:e,handleInsert:f,update:i}),document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot")),he.createPortal(n.jsxs($,{type:"button",onClick:()=>h(w=>!w),className:"px-2",children:[n.jsx("div",{className:"mr-1 h-5 w-5",children:n.jsx(We,{})}),n.jsx("span",{children:"AI"})]}),document.querySelector(`.merlin.fab-btn.${e}`).shadowRoot.getElementById("reactAppRootBtn"))]})})})})})})})}const ba=({attributes:e,handleInsert:t,id:r,mailThread:a,setIsVisible:s,setPopperElement:o,styles:i,update:u})=>{const[c,h]=E.useState(!0),[p,l]=E.useState(!0);return E.useEffect(()=>{const m=new MutationObserver(lt(()=>{if(u&&u(),!document.querySelector(`.${r}`)){h(!1),m.disconnect();return}},100));return m.observe(document.body,{childList:!0,subtree:!0}),()=>m.disconnect()},[r,u]),E.useEffect(()=>{const m=new MutationObserver(()=>{try{document.querySelector(`.${r}`).closest(".nH").style.display==="none"?l(!1):l(!0)}catch{}});return m.observe(document.querySelector(`.${r}`).closest(".nH"),{attributeFilter:["style"],attributes:!0}),()=>m.disconnect()},[r]),c?n.jsx("div",{ref:o,style:i.popper,...e.popper,className:`mb-48 ${p?"":"hidden"}`,children:n.jsx(qe.div,{initial:{opacity:0,scale:0,y:150},animate:{opacity:1,scale:1,y:0},children:n.jsx(vt,{handleInsert:t,setIsVisible:s,mountOn:"GMAIL_REPLY",id:r,mailThread:a})})}):null};function wa({id:e}){var w,A;const[t,r]=_e.useState(null),[a,s]=_e.useState(null),{attributes:o,forceUpdate:i,styles:u}=ir(t,a,{placement:"top"}),c=Ie(),[h,p]=E.useState([]),[l,m]=E.useState(!1),f=se(q=>q.usingAIComposeBtn),C=se(q=>q.toggleUsingAIComposeBtn);E.useEffect(()=>{const q=(b,d)=>{var x,j,S,g,v,N,T,I,P,L,M,B,O;if(b!=null&&b.querySelector("blockquote.gmail_quote")){const k=b.querySelector("blockquote.gmail_quote"),F=((j=(x=k.parentNode)==null?void 0:x.querySelector(".gmail_attr"))==null?void 0:j.textContent)??((S=k.parentNode)==null?void 0:S.textContent)??"",G=new RegExp("(?<=<)(.*?)(?=>)"),ee=/(\d{1,2} \w{3} \d{4} at \d{2}:\d{2})/,ae=new RegExp("(?<=\\s)([\\w\\s]+)(?=\\s<)"),X=new RegExp("(?<=<)(.*?)(?=>)"),U=/\w{3}, \w{3} \d{1,2}, \d{4} at \d{1,2}:\d{2}\s(?:AM|PM)/,te=((v=(g=F.match(ae))==null?void 0:g[0])==null?void 0:v.replace(/\b(?:AM|PM)\b/g,""))??"",oe=((N=F.match(G))==null?void 0:N[0])??((T=F.match(X))==null?void 0:T[0]),K=((I=F.match(ee))==null?void 0:I[0])??((P=F.match(U))==null?void 0:P[0]),re=(O=(M=k.textContent)==null?void 0:M.replace((L=k.querySelector("blockquote.gmail_quote"))==null?void 0:L.textContent,""))==null?void 0:O.replace((B=k.querySelector(".gmail_attr"))==null?void 0:B.textContent,"");d.push({content:re==null?void 0:re.replace(/\s\s+/gm," "),email:oe,name:te,timestamp:K}),q(b.querySelector("blockquote.gmail_quote"),d)}};(async()=>{var d,x,j,S,g,v;const b=[];(S=(j=(x=(d=document.querySelector(`.merlin.fab-btn.${e}`))==null?void 0:d.closest(".ip.adB"))==null?void 0:x.querySelector("img.ajT"))==null?void 0:j.parentElement)==null||S.click(),q((v=(g=document.querySelector(`.merlin.fab-btn.${e}`))==null?void 0:g.closest(".ip.adB"))==null?void 0:v.querySelector(".gmail_quote"),b),p(b.reverse())})()},[e]);const y=q=>{try{const R=/^Subject: .*(\r?\n|\r)/;q=q.trim().replace(R,"");const d=q.split(`
`).map(x=>x===""?"<div></div><br/>":`<div>${x}</div>`);document.querySelector(`.fab-writer.${e}`).closest(".ip.adB").querySelector("[contenteditable=true]").innerHTML=d.join(`
`)+`
`+document.querySelector(`.fab-writer.${e}`).closest(".ip.adB").querySelector("[contenteditable=true]").innerHTML,m(!1)}catch{}};if(E.useEffect(()=>{f&&(m(!0),C())},[]),(A=(w=c.details)==null?void 0:w.gmail)!=null&&A.isEnabled)return n.jsx(at,{children:n.jsx(ot,{children:n.jsx(Ut,{children:n.jsx(st,{children:n.jsx(Vt,{children:n.jsx(it,{websiteOverride:!0,children:n.jsxs("div",{className:"flex w-full justify-center",children:[l&&he.createPortal(n.jsx(ba,{setPopperElement:s,styles:u,attributes:o,setIsVisible:m,id:e,handleInsert:y,update:i,mailThread:h}),document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot")),he.createPortal(n.jsxs($,{type:"button",onClick:()=>m(q=>!q),className:`z-50 px-2 ${e}`,ref:r,children:[n.jsx("div",{className:"mr-1 h-5 w-5",children:n.jsx(We,{})}),n.jsx("span",{children:"AI"})]}),document.querySelector(`.merlin.fab-btn.${e}`).shadowRoot.getElementById("reactAppRootBtn"))]})})})})})})})}const ja=()=>{const{...e}=E.useContext(wr);return{getUserPrompts:jr({queryFn:async()=>e.isLoading||!e.isAuthenticated?null:await Xr(),queryKey:["userPrompts"]})}},Sa=()=>{const e=Sr();return yr({mutationFn:async r=>await Zr(r),onSuccess:r=>{e.setQueryData(["userPrompts"],r)}})},Na=[{promptName:"Friendly",promptTag:"GmailReply",promptText:"Write a friendly reply in an informal tone"},{promptName:"Funny",promptTag:"GmailReply",promptText:"Write a funny reply"},{promptName:"Professional",promptTag:"GmailReply",promptText:"Write a professional reply"}],Ca=({handleInsert:e,id:t,mailThread:r,setIsVisible:a})=>n.jsx("div",{className:"absolute translate-x-[60vw] translate-y-1/4",children:n.jsx(qe.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},children:n.jsx(vt,{setIsVisible:a,mailThread:r,handleInsert:e,mountOn:"GMAIL_REPLY",id:t})})}),Aa=({id:e})=>{var A,q,R,b;const{t}=He(),[r,a]=E.useState(!1),[s,o]=E.useState([]),[i,u]=E.useState(""),c=se(d=>d.setQuickPromptAIReply),h=E.useRef(null),{getUserPrompts:p}=ja();Sa();const l=E.useMemo(()=>{var d,x,j;return(j=(x=(d=p==null?void 0:p.data)==null?void 0:d.userPrompts)==null?void 0:x.userMade)==null?void 0:j.filter(S=>{var g,v,N,T,I;return((g=S==null?void 0:S.promptTag)==null?void 0:g.includes("GmailReply"))&&(((N=(v=S==null?void 0:S.promptName)==null?void 0:v.toLocaleLowerCase())==null?void 0:N.includes(i==null?void 0:i.toLocaleLowerCase()))||((I=(T=S==null?void 0:S.promptText)==null?void 0:T.toLocaleLowerCase())==null?void 0:I.includes(i==null?void 0:i.toLocaleLowerCase())))})},[i,(q=(A=p==null?void 0:p.data)==null?void 0:A.userPrompts)==null?void 0:q.userMade]),m=E.useMemo(()=>{var d,x,j;return(j=(x=(d=p==null?void 0:p.data)==null?void 0:d.userPrompts)==null?void 0:x.userMade)==null?void 0:j.filter(S=>{var g,v,N,T,I;return!((g=S==null?void 0:S.promptTag)!=null&&g.includes("GmailReply"))&&(((N=(v=S==null?void 0:S.promptName)==null?void 0:v.toLocaleLowerCase())==null?void 0:N.includes(i==null?void 0:i.toLocaleLowerCase()))||((I=(T=S==null?void 0:S.promptText)==null?void 0:T.toLocaleLowerCase())==null?void 0:I.includes(i==null?void 0:i.toLocaleLowerCase())))})},[i,(b=(R=p==null?void 0:p.data)==null?void 0:R.userPrompts)==null?void 0:b.userMade]),f=Na.filter(d=>{var x,j,S,g,v;return((x=d==null?void 0:d.promptTag)==null?void 0:x.includes("GmailReply"))&&(((S=(j=d==null?void 0:d.promptName)==null?void 0:j.toLocaleLowerCase())==null?void 0:S.includes(i==null?void 0:i.toLocaleLowerCase()))||((v=(g=d==null?void 0:d.promptText)==null?void 0:g.toLocaleLowerCase())==null?void 0:v.includes(i==null?void 0:i.toLocaleLowerCase())))}),C=(d,x)=>{var j,S,g,v,N,T,I,P,L,M,B,O,k,F;if(d!=null&&d.querySelector("blockquote.gmail_quote")){const G=((S=(j=d.querySelector("blockquote.gmail_quote").parentNode)==null?void 0:j.querySelector(".gmail_attr"))==null?void 0:S.textContent)??((g=d.querySelector("blockquote.gmail_quote").parentNode)==null?void 0:g.textContent)??"",ee=new RegExp("(?<=<)(.*?)(?=>)"),ae=/(\d{1,2} \w{3} \d{4} at \d{2}:\d{2})/,X=new RegExp("(?<=\\s)([\\w\\s]+)(?=\\s<)"),U=new RegExp("(?<=<)(.*?)(?=>)"),te=/\w{3}, \w{3} \d{1,2}, \d{4} at \d{1,2}:\d{2}\s(?:AM|PM)/,oe=((N=(v=G.match(X))==null?void 0:v[0])==null?void 0:N.replace(/\b(?:AM|PM)\b/g,""))??"",K=((T=G.match(ee))==null?void 0:T[0])??((I=G.match(U))==null?void 0:I[0]),re=((P=G.match(ae))==null?void 0:P[0])??((L=G.match(te))==null?void 0:L[0]),we=(F=(O=(M=d.querySelector("blockquote.gmail_quote"))==null?void 0:M.textContent)==null?void 0:O.replace((B=d.querySelector("blockquote.gmail_quote").querySelector("blockquote.gmail_quote"))==null?void 0:B.textContent,""))==null?void 0:F.replace((k=d.querySelector("blockquote.gmail_quote").querySelector(".gmail_attr"))==null?void 0:k.textContent,"");x.push({content:we==null?void 0:we.replace(/\s\s+/gm," "),email:K,name:oe,timestamp:re}),C(d.querySelector("blockquote.gmail_quote"),x)}},y=async({prompt:d})=>{var S,g,v,N,T,I,P;const x=[],j=(S=document==null?void 0:document.querySelector(`.merlin-external.${e}`))==null?void 0:S.closest('[role="listitem"]');x.push({content:(T=(N=(g=j==null?void 0:j.querySelector(".a3s.aiL"))==null?void 0:g.textContent)==null?void 0:N.replace((v=j.querySelector("blockquote.gmail_quote"))==null?void 0:v.textContent,""))==null?void 0:T.replace(/\s\s+/gm," "),email:j==null?void 0:j.querySelector("[name][email]").getAttribute("email"),name:j==null?void 0:j.querySelector("[name][email]").getAttribute("name"),timestamp:(I=j==null?void 0:j.querySelector("[alt][title]"))==null?void 0:I.getAttribute("title")}),C((P=j==null?void 0:j.querySelector(".a3s.aiL"))==null?void 0:P.querySelector(".gmail_quote"),x),o(x.reverse()),c(d),await new Promise(L=>{a(M=>!M),setTimeout(()=>L(!0),50)}),await new Promise(L=>{a(!0),setTimeout(()=>L(!0),50)})},w=d=>{try{const x=/^Subject: .*(\r?\n|\r)/;d=d.trim().replace(x,"");const S=d.split(`
`).map(g=>g===""?"<div></div><br/>":`<div>${g}</div>`);try{document.querySelector(`.merlin-external.${e}`).closest(".gA.gt").querySelector(".ams.bkI").click()}catch{try{document.querySelector(`.merlin-external.${e}`).closest(".gA.gt").querySelector(".ams.bkH").click()}catch{}}setTimeout(()=>document.querySelector(`.merlin-external.${e}`).closest(".gA.gt").querySelector("[contenteditable=true]").innerHTML=S.join(`
`)+`

`+document.querySelector(`.merlin-external.${e}`).closest(".gA.gt").querySelector("[contenteditable=true]").innerHTML,50),a(!1)}catch{}};return E.useEffect(()=>{h.current&&(h.current.style.height="auto",h.current.style.height=h.current.scrollHeight+"px")},[i]),n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"relative mb-2.5 ml-24 flex items-end gap-3 py-1",id:"ai-reply",children:[n.jsx("div",{className:"absolute -left-10 top-1.5 h-7 w-7",children:n.jsx(We,{})}),n.jsx(ct,{onChange:d=>u(String(d.target.value)),rows:1,value:i,ref:h,placeholder:"Write your reply to generate with AI",className:It("peer min-h-1 w-80 transition-all duration-200 ease-in-out focus:w-[26.68rem]",i.length&&"w-[26.68rem]"),onKeyDown:d=>{d.key==="Enter"&&i.trim()&&!d.shiftKey&&(y({prompt:i.trim()}),setTimeout(()=>{u("")},0))}}),n.jsxs($,{onClick:()=>{_({eventName:"GenerateAIReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),y({prompt:i}),u("")},variant:"default",className:It("items-center justify-center peer-focus:flex",!i.length&&"hidden"),children:[t("Generate"),n.jsx(et,{className:"ml-2 h-5 w-5"})]}),!i.length&&n.jsxs(n.Fragment,{children:[n.jsx($,{onClick:()=>{_({eventName:"YesQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),y({prompt:"Respond to these matters affirmatively, expressing your interest."})},variant:"outline",className:"peer-focus:hidden",children:t("yes")}),n.jsx($,{onClick:()=>{_({eventName:"NoQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),y({prompt:"Respond to these matters saying no, expressing your rejection or dis-interest."})},variant:"outline",className:"peer-focus:hidden",children:t("no")}),n.jsx($,{onClick:()=>{_({eventName:"FollowUpQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),y({prompt:"Write a email to follow up again"})},variant:"outline",className:"peer-focus:hidden",children:t("super_gmail.follow_up")})]}),n.jsx(Xt,{children:(i==null?void 0:i.length)&&((f==null?void 0:f.length)||l&&(l==null?void 0:l.length)||m&&(m==null?void 0:m.length))&&n.jsx(qe.div,{initial:{opacity:0,originY:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0,originY:0,scaleY:0},className:"left-26 absolute top-12 z-10 ml-0 w-[26.68rem]",children:n.jsx(de,{className:"rounded-md py-2",children:n.jsx(Fe,{className:"max-h-28 overflow-scroll",children:n.jsxs("div",{className:"flex w-full flex-col gap-1 text-sm",children:[n.jsxs(n.Fragment,{children:[l&&(l==null?void 0:l.length)!==0&&n.jsx("p",{className:"text-muted-foreground ml-2 text-xs",children:"Gmail Prompts"}),l&&(l==null?void 0:l.map(d=>n.jsx("div",{onClick:()=>{y({prompt:d.promptText}),u("")},className:"hover:bg-secondary cursor-pointer px-3 py-1",children:t(d.promptName)},d.id)))]}),l&&(l==null?void 0:l.length)!==0&&(f==null?void 0:f.length)!==0&&n.jsx(me,{}),n.jsxs(n.Fragment,{children:[(f==null?void 0:f.length)!==0&&n.jsx("p",{className:"text-muted-foreground ml-2 mt-1 text-xs",children:"Recommended Prompts"}),f==null?void 0:f.map((d,x)=>n.jsx("div",{onClick:()=>{_({eventName:`${d.promptName}QuickReply`,eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),y({prompt:d.promptText}),u("")},className:"hover:bg-secondary cursor-pointer px-3 py-1",children:t(`${d.promptName} Reply`)},x))]}),(f==null?void 0:f.length)!==0&&m&&(m==null?void 0:m.length)!==0&&n.jsx(me,{}),n.jsxs(n.Fragment,{children:[m&&(m==null?void 0:m.length)!==0&&n.jsx("p",{className:"text-muted-foreground ml-2 mt-1 text-xs",children:"Other Prompts"}),m&&(m==null?void 0:m.map(d=>n.jsx("div",{onClick:()=>{y({prompt:d.promptText}),u("")},className:"hover:bg-secondary cursor-pointer px-3 py-1",children:t(d.promptName)},d.id)))]})]})})})})})]}),r&&he.createPortal(n.jsx(Ca,{setIsVisible:a,mailThread:s,handleInsert:w,id:e}),document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))]})};function Ea({id:e}){var r,a;return(a=(r=Ie().details)==null?void 0:r.gmail)!=null&&a.isEnabled?n.jsx(at,{children:n.jsx(ot,{children:n.jsx(st,{children:n.jsx(it,{websiteOverride:!0,children:n.jsx(Aa,{id:e})})})})}):null}function Ia(){var s,o;const e=se(i=>i.toggleUsingAIComposeBtn),t=Ie(),[r,a]=E.useState(!0);return E.useEffect(()=>{var c;const i=(c=document.querySelector(".T-I-KE"))==null?void 0:c.closest("[role='navigation']"),u=document.querySelector("[aria-label='Main menu']");if(i){a(!1);const h=new MutationObserver(()=>{i.classList.contains("bym")||u.getAttribute("aria-expanded")==="true"?a(!0):a(!1)});h.observe(i,{attributeFilter:["class"],attributes:!0}),h.observe(u,{attributeFilter:["class"],attributes:!0}),u.getAttribute("aria-expanded")==="true"&&!i.classList.contains("bhz")&&a(!0)}},[]),E.useEffect(()=>{document.querySelector(".T-I-KE").style.zIndex="1",document.querySelector(".T-I-KE").parentNode.style.position="relative"},[]),(o=(s=t.details)==null?void 0:s.gmail)!=null&&o.isEnabled?n.jsx("button",{type:"button",onClick:()=>{_({eventName:"GlobalAiComposeBtn",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/AIComposeBtn"}),e(),document.querySelector(".T-I-KE").click()},className:`animate-border absolute bottom-0 left-32 top-0 items-stretch rounded-r-2xl bg-gradient-to-t from-fuchsia-200 via-purple-300 to-indigo-100 p-0.5 shadow-lg active:shadow-sm ${r?"":"hidden"}`,children:n.jsx("div",{className:"text-primary bg-background flex h-full items-center rounded-r-2xl px-5 pl-7 transition-all hover:pl-8",children:"AI"})}):null}const qa=()=>new Promise(e=>{if(window.location.origin.includes("mail.google.com")){const t=new MutationObserver(()=>{const r=document.getElementById("loading");r.style.display==="none"&&(e(r),t.disconnect())});t.observe(document.body,{childList:!0,subtree:!1})}}),Ta=async e=>{const t=`u${fe()}`,r=document.createElement("merlin-component"),a=document.createElement("merlin-button-component");r.className=`merlin fab-writer ${t}`,a.className=`merlin fab-btn ${t}`;const s=r.attachShadow({mode:"open"}),o=a.attachShadow({mode:"open"}),i=document.createElement("style"),u=document.createElement("style");i.textContent=`${ue}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: absolute;
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `,u.textContent=`${ue}
      .fab-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const c=document.createElement("div");c.id="reactAppRoot",c.className="reactAppRoot fabStrip";const h=document.createElement("div");h.id="reactAppRootBtn",h.className="reactAppRootBtn fabBtn center-with-flex",s.appendChild(i),s.appendChild(c),e.querySelector("#sbddm").insertAdjacentElement("afterend",r),o.appendChild(u),o.appendChild(h);try{const f=e.querySelector(".gU.aYL");f.style.cssText="display: flex; gap: 0.5em; justify-content: center; align-items: center;",f.append(a)}catch{}const p={fowarding:!1,messages:[],signature:"",user:""};let l=null;try{l=document.querySelector("div.gb_Z.gb_C a").getAttribute("aria-label").replace("Google Account: ","").replace(`
`,""),p.user=l}catch{}De.forEach(f=>{c.addEventListener(f,C=>{C.stopPropagation()})});const m=ge(c);ge(h),m.render(n.jsx(ya,{id:t}))},Oa=async e=>{const t=`u${fe()}`,r=document.createElement("merlin-component"),a=document.createElement("merlin-button-component");r.className=`merlin fab-writer ${t}`,a.className=`merlin fab-btn ${t}`;const s=r.attachShadow({mode:"open"}),o=a.attachShadow({mode:"open"}),i=document.createElement("style"),u=document.createElement("style");i.textContent=`${ue}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: absolute;
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `,u.textContent=`${ue}
      .fab-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const c=document.createElement("div");c.id="reactAppRoot",c.className="reactAppRoot fabStrip";const h=document.createElement("div");h.id="reactAppRootBtn",h.className="reactAppRootBtn fabBtn center-with-flex",s.appendChild(i),s.appendChild(c),e.querySelector("#sbddm").insertAdjacentElement("afterend",r),o.appendChild(u),o.appendChild(h);try{const f=e.querySelector(".gU.aYL");f.style.cssText="display: flex; gap: 0.5em; justify-content: center; align-items: center;",f.append(a)}catch{}const p={fowarding:!1,messages:[],signature:"",user:""};let l=null;try{l=document.querySelector("div.gb_Z.gb_C a").getAttribute("aria-label").replace("Google Account: ","").replace(`
`,""),p.user=l}catch{}De.forEach(f=>{c.addEventListener(f,C=>{C.stopPropagation()})});const m=ge(c);ge(h),m.render(n.jsx(wa,{id:t}))},Ra=async e=>{const t=`u${fe()}`,r=document.createElement("merlin-component");r.className=`merlin fab-writer merlin-external ${t}`;const a=r.attachShadow({mode:"open"}),s=document.createElement("style");s.textContent=`${ue}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `;const o=document.createElement("div");o.id="reactAppRoot",o.className="reactAppRoot fabStrip",De.forEach(u=>{o.addEventListener(u,c=>{c.stopPropagation()})}),a.appendChild(s),a.appendChild(o),e.prepend(r),ge(o).render(n.jsx(Ea,{id:t}))},Ma=async()=>{var s;const e=document.createElement("merlin-component");e.className="merlin ai-compose-btn";const t=e.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=`${ue}
      .ai-compose-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const a=document.createElement("div");a.id="reactAppRootBtn",a.className="reactAppRootBtn",t.appendChild(r),t.appendChild(a),(s=document.querySelector(".T-I-KE"))!=null&&s.parentNode?document.querySelector(".T-I-KE").parentNode.append(e):document.querySelector(".z0")&&document.querySelector(".z0").append(e),ge(a).render(n.jsx(Ia,{}))},La=async()=>{if(document.getElementById("merlin-gmail-uicomponentportal"))return;const e=document.createElement("merlin-component");e.id="merlin-gmail-uicomponentportal",e.className="merlin merlin-gmail-uicomponentportal";const t=e.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=`${ue}
    :host(#merlin-gmail-uicomponentportal) {
    }   
    .reactAppRoot {
      all: initial; /* 1st rule so subsequent properties are reset. */
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 2147483640;
    }
    `.replaceAll(":root",":host");const a=document.createElement("div");a.id="reactAppRoot",a.className="reactAppRoot",De.forEach(s=>{a.addEventListener(s,o=>{o.stopPropagation()})}),t.appendChild(r),t.appendChild(a),document.documentElement.append(e)},Pa=async()=>{La();const e=await Nr.fetchQuery(Cr);if(e&&!e.fabStrip.gmail.visible)return;await qa();const t=new MutationObserver(lt(()=>{const a=document.querySelectorAll(".nH.Hd");if(a.length>0)for(let i=0;i<a.length;i+=1){const u=a[i].querySelector("merlin-component"),c=a[i].querySelector("merlin-button-component");!u&&!c&&Ta(a[i])}const s=document.querySelectorAll(".ip.adB");if(s.length>0)for(let i=0;i<s.length;i+=1){const u=s[i].querySelector("merlin-component"),c=s[i].querySelector("merlin-button-component");!u&&!c&&Oa(s[i])}const o=document.querySelectorAll(".gA.gt");if(o.length>0){const i=o[o.length-1];let u=document.querySelector(".merlin.fab-writer.merlin-external");!i.querySelector(".merlin.fab-writer.merlin-external")&&u&&(u.remove(),u=null),u||Ra(i)}},300)),r={attributes:!0,childList:!0,subtree:!1};t.observe(document.body,r),Ma()};Pa();
