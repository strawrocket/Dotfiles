import{q as Le,Q as Te,p as De}from"./index-5ad58ea9.js";import{h as Oe}from"./backend-f1dada26.js";import{A as ie}from"./constants-e5712b98.js";class B extends Error{constructor(t,r){super(t+" at position "+r),this.position=r}}const X=92,ne=47,Ne=42,ue=123,Y=125,he=91,Z=93,_e=40,Ue=41,Me=32,ae=10,Ae=9,Se=13,Ie=8,Fe=12,re=34,fe=43,de=45,Ee=39,ke=48,qe=57,R=44,j=46,Pe=58,Re=59,He=65,$e=97,Be=69,Qe=101,Ge=70,We=102,ze=160,Ve=8192,Je=8202,Ke=8239,Xe=8287,Ye=12288,Ze=8220,je=8221,et=8216,tt=8217,rt=96,nt=180;function ot(e){return e>=ke&&e<=qe||e>=He&&e<=Ge||e>=$e&&e<=We}function H(e){return e>=ke&&e<=qe}function ct(e){return e>=32&&e<=1114111}function G(e){return st.test(e)}const st=/^[,:[\]/{}()\n+]$/;function it(e){return G(e)&&e!=="/"}function me(e){return at.test(e)||e&&ee(e.charCodeAt(0))}const at=/^[[{\w-]$/;function lt(e){return e===ae||e===Se||e===Ae||e===Ie||e===Fe}function W(e){return e===Me||e===ae||e===Ae||e===Se}function ut(e){return e===ze||e>=Ve&&e<=Je||e===Ke||e===Xe||e===Ye}function ee(e){return xe(e)||ce(e)}function xe(e){return e===re||e===Ze||e===je}function ge(e){return e===re}function ce(e){return e===Ee||e===et||e===tt||e===rt||e===nt}function pe(e){return e===Ee}function J(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const c=e.lastIndexOf(t);return c!==-1?e.substring(0,c)+(r?"":e.substring(c+1)):e}function _(e,t){let r=e.length;if(!W(e.charCodeAt(r-1)))return e+t;for(;W(e.charCodeAt(r-1));)r--;return e.substring(0,r)+t+e.substring(r)}function ht(e,t,r){return e.substring(0,t)+e.substring(t+r)}function ft(e){return/[,\n][ \t\r]*$/.test(e)}function dt(e){return/^\w+$/.test(e)}const mt={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},gt={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function pt(e){let t=0,r="";h()||T();const o=i(R);for(o&&n(),me(e[t])&&ft(r)?(o||(r=_(r,",")),d()):o&&(r=J(r,","));e.charCodeAt(t)===Y||e.charCodeAt(t)===Z;)t++,n();if(t>=e.length)return r;x();function h(){n();const l=A()||g()||u()||y()||C()||v();return n(),l}function n(){const l=t;let b=a();do b=s(),b&&(b=a());while(b);return t>l}function a(){let l="",b;for(;(b=W(e.charCodeAt(t)))||ut(e.charCodeAt(t));)b?l+=e[t]:l+=" ",t++;return l.length>0?(r+=l,!0):!1}function s(){if(e.charCodeAt(t)===ne&&e.charCodeAt(t+1)===Ne){for(;t<e.length&&!wt(e,t);)t++;return t+=2,!0}if(e.charCodeAt(t)===ne&&e.charCodeAt(t+1)===ne){for(;t<e.length&&e.charCodeAt(t)!==ae;)t++;return!0}return!1}function i(l){return e.charCodeAt(t)===l?(r+=e[t],t++,!0):!1}function f(l){return e.charCodeAt(t)===l?(t++,!0):!1}function p(){return f(X)}function w(){return n(),e.charCodeAt(t)===j&&e.charCodeAt(t+1)===j&&e.charCodeAt(t+2)===j?(t+=3,n(),f(R),!0):!1}function A(){if(e.charCodeAt(t)===ue){r+="{",t++,n(),f(R)&&n();let l=!0;for(;t<e.length&&e.charCodeAt(t)!==Y;){let b;if(l?(b=!0,l=!1):(b=i(R),b||(r=_(r,",")),n()),w(),!(u()||v())){e.charCodeAt(t)===Y||e.charCodeAt(t)===ue||e.charCodeAt(t)===Z||e.charCodeAt(t)===he||e[t]===void 0?r=J(r,","):M();break}n();const z=i(Pe),$=t>=e.length;z||(me(e[t])||$?r=_(r,":"):K()),h()||(z||$?r+="null":K())}return e.charCodeAt(t)===Y?(r+="}",t++):r=_(r,"}"),!0}return!1}function g(){if(e.charCodeAt(t)===he){r+="[",t++,n(),f(R)&&n();let l=!0;for(;t<e.length&&e.charCodeAt(t)!==Z;)if(l?l=!1:i(R)||(r=_(r,",")),w(),!h()){r=J(r,",");break}return e.charCodeAt(t)===Z?(r+="]",t++):r=_(r,"]"),!0}return!1}function d(){let l=!0,b=!0;for(;b;)l?l=!1:i(R)||(r=_(r,",")),b=h();b||(r=J(r,",")),r=`[
`.concat(r,`
]`)}function u(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,b=e.charCodeAt(t)===X;if(b&&(t++,b=!0),ee(e.charCodeAt(t))){const F=ge(e.charCodeAt(t))?ge:pe(e.charCodeAt(t))?pe:ce(e.charCodeAt(t))?ce:xe,z=t,$=r.length;let q='"';for(t++;;){if(t>=e.length){const D=O(t-1);return!l&&G(e.charAt(D))?(t=z,r=r.substring(0,$),u(!0)):(q=_(q,'"'),r+=q,!0)}else if(F(e.charCodeAt(t))){const D=t,P=q.length;if(q+='"',t++,r+=q,n(),l||t>=e.length||G(e.charAt(t))||ee(e.charCodeAt(t))||H(e.charCodeAt(t)))return m(),!0;if(G(e.charAt(O(D-1))))return t=z,r=r.substring(0,$),u(!0);r=r.substring(0,$),t=D+1,q=q.substring(0,P)+"\\"+q.substring(P)}else{if(l&&G(e[t]))return q=_(q,'"'),r+=q,m(),!0;if(e.charCodeAt(t)===X){const D=e.charAt(t+1);if(gt[D]!==void 0)q+=e.slice(t,t+2),t+=2;else if(D==="u"){let V=2;for(;V<6&&ot(e.charCodeAt(t+V));)V++;V===6?(q+=e.slice(t,t+6),t+=6):t+V>=e.length?t=e.length:N()}else q+=D,t+=2}else{const D=e.charAt(t),P=e.charCodeAt(t);P===re&&e.charCodeAt(t-1)!==X?(q+="\\"+D,t++):lt(P)?(q+=mt[D],t++):(ct(P)||S(D),q+=D,t++)}}b&&p()}}return!1}function m(){let l=!1;for(n();e.charCodeAt(t)===fe;){l=!0,t++,n(),r=J(r,'"',!0);const b=r.length;u()?r=ht(r,b,1):r=_(r,'"')}return l}function y(){const l=t;if(e.charCodeAt(t)===de){if(t++,L())return k(l),!0;if(!H(e.charCodeAt(t)))return t=l,!1}for(;H(e.charCodeAt(t));)t++;if(e.charCodeAt(t)===j){if(t++,L())return k(l),!0;if(!H(e.charCodeAt(t)))return t=l,!1;for(;H(e.charCodeAt(t));)t++}if(e.charCodeAt(t)===Qe||e.charCodeAt(t)===Be){if(t++,(e.charCodeAt(t)===de||e.charCodeAt(t)===fe)&&t++,L())return k(l),!0;if(!H(e.charCodeAt(t)))return t=l,!1;for(;H(e.charCodeAt(t));)t++}if(!L())return t=l,!1;if(t>l){const b=e.slice(l,t),F=/^0\d/.test(b);return r+=F?'"'.concat(b,'"'):b,!0}return!1}function C(){return E("true","true")||E("false","false")||E("null","null")||E("True","true")||E("False","false")||E("None","null")}function E(l,b){return e.slice(t,t+l.length)===l?(r+=b,t+=l.length,!0):!1}function v(){const l=t;for(;t<e.length&&!it(e[t])&&!ee(e.charCodeAt(t));)t++;if(t>l){if(e.charCodeAt(t)===_e&&dt(e.slice(l,t).trim()))return t++,h(),e.charCodeAt(t)===Ue&&(t++,e.charCodeAt(t)===Re&&t++),!0;{for(;W(e.charCodeAt(t-1))&&t>0;)t--;const b=e.slice(l,t);return r+=b==="undefined"?"null":JSON.stringify(b),e.charCodeAt(t)===re&&t++,!0}}}function O(l){let b=l;for(;b>0&&W(e.charCodeAt(b));)b--;return b}function L(){return t>=e.length||G(e[t])||W(e.charCodeAt(t))}function k(l){r+=e.slice(l,t)+"0"}function S(l){throw new B("Invalid character "+JSON.stringify(l),t)}function x(){throw new B("Unexpected character "+JSON.stringify(e[t]),t)}function T(){throw new B("Unexpected end of json string",e.length)}function M(){throw new B("Object key expected",t)}function K(){throw new B("Colon expected",t)}function N(){const l=e.slice(t,t+6);throw new B('Invalid unicode character "'.concat(l,'"'),t)}}function wt(e,t){return e[t]==="*"&&e[t+1]==="/"}const Q=360,I=10,Dt=e=>{const t=e&&e.getBoundingClientRect(),r={above:t.top-I,below:window.innerHeight-t.bottom-I,left:t.left-I,right:window.innerWidth-t.right-I},{above:c,below:o,left:h,right:n}=r;return c>o?Q/2+I*2<h&&Q/2+I*2<n?{bottom:window.innerHeight-t.top+"px",left:t.left-(Q-t.width)/2+"px",position:"fixed"}:n>h?{bottom:window.innerHeight-t.top+"px",left:t.left+"px",position:"fixed"}:{bottom:window.innerHeight-t.top+"px",position:"fixed",right:window.innerWidth-t.right+"px"}:Q/2+I*2<h&&Q/2+I*2<n?{left:t.left+t.width/2-Q/2+"px",position:"fixed",top:t.bottom+"px"}:n>h?{left:t.left+"px",position:"fixed",top:t.bottom+"px"}:{position:"fixed",right:window.innerWidth-t.right+"px",top:t.bottom+"px"}},se=e=>{if(e.nodeType===Node.COMMENT_NODE||e.tagName==="SCRIPT"||e.tagName==="STYLE"||e.tagName==="HEADER"||e.tagName==="FOOTER"||e.tagName==="NAV"||e.tagName==="ASIDE"||e.tagName==="NOSCRIPT")return"";let t="";if(e.nodeType===Node.TEXT_NODE)t=e==null?void 0:e.textContent;else for(let r=0;r<e.childNodes.length;r++)t+=`${se(e.childNodes[r])}
`;return t},le=7;function yt(e,t,r){switch(e){case"google":return"https://www.google.com/search";case"bing":return"https://www.bing.com/search";case"baidu":return t?"https://www.baidu.com/s":r?"https://image.baidu.com/search/acjson":"https://www.baidu.com/s";case"duckduckgo":return"https://duckduckgo.com/";case"yahoo":return t?"https://news.search.yahoo.com/search":r?"https://images.search.yahoo.com/search/images":"https://search.yahoo.com/search";case"naver":return"https://search.naver.com/search.naver";case"yandex":return"https://yandex.com/search/";case"sogou":return"https://www.sogou.com/web";case"brave":return"https://search.brave.com/search";case"reddit":return"https://www.reddit.com/search";case"twitter":return"https://twitter.com/search";case"youtube":return"https://www.youtube.com/results";case"amazon":return"https://www.amazon.com/s";default:return"https://www.google.com/search"}}function bt(e,t=!1,r=!1,c){const o={...c};delete o.limit,o.region&&o.region!=="wt-wt"&&(e==="google"?o.query=`location:${o.region} ${o.query}`:o.query=`${o.query}`,delete o.region),e!=="google"&&delete o.region;let h=o.query;switch(delete o.query,o.site&&(h=`site:${o.site} ${h}`),delete o.site,e){case"yahoo":{o.p=h;break}case"baidu":{if(t){o.word=h;break}o.wd=h;break}case"naver":case"sogou":{o.query=h;break}case"yandex":{o.text=h;break}case"bing":case"duckduckgo":case"brave":case"google":default:o.q=h}if(r)switch(e){case"google":{o.tbm="isch",o.udm="2";break}case"baidu":{o.tn="resultjson_com",o.word=h;break}}if(t)switch(e){case"google":{o.tbm="nws";break}case"baidu":{o.tn="news";break}}return new URLSearchParams({...o})}function ve(e,t){const r=yt(e,t.shouldSearchNews,t.shouldSearchImage),c=bt(e,t.shouldSearchNews,t.shouldSearchImage,{limit:t.limit,query:t.query,region:t.region,site:t.site});return`${r}?${c.toString()}`}function Ct(e){const t=e.cloneNode(!0);return t.querySelectorAll('*[style*="display: none"]').forEach(c=>{c.parentNode.removeChild(c)}),t}function At(e){try{const t=new DOMParser().parseFromString(e,"text/html"),r=Ct(t.body),c={FORBID_TAGS:["style","noscript","script","svg","img","iframe","video"],USE_PROFILES:{html:!0}};let o=De.sanitize(r,{...c});return St(o)>we&&(o=o.slice(0,we)),o}catch{return e||""}}const we=1e6,St=e=>new Blob([e]).size,Et=e=>{if(!e)return"";try{const t=/^(?:https?:\/\/)?(?:www\.)?((?:(?!www\.|\.).)+\.[-a-zA-Z0-9.]+)/gm,r=e.match(t);return(r?r[0]:"").toLowerCase()}catch{return e}},kt=e=>{try{return e?(e.search(/^http[s]?:\/\//)==-1&&(e="https://"+e),e):""}catch{return e||""}},U=(e,t=64)=>{try{const r=Et(e)||`${e==null?void 0:e.toLowerCase()}.com`;return`https://www.google.com/s2/favicons?sz=${t}&domain_url=${r}`}catch{return""}};function oe(e){try{return e.trim().replaceAll(`
  `,"")||""}catch{return e||""}}function ye(e){try{const t=kt(e.trim().replaceAll("...","")),r=new URL(t).host.split(".");return r.length>=3?r[1]:r[0]}catch{return e}}const Ot=async(e,t=0,r=1500)=>{if(t>le)return{html:"",status:301,success:!1,url:e};try{const c=await fetch(e,{credentials:"omit",redirect:"follow",signal:AbortSignal.timeout(r)});if(!c.ok){const h=c.type==="opaqueredirect"?301:c.status;throw{status:h,statusText:`Failed to fetch: ${h} ${c.statusText}`}}const o=await c.text();if(!o)throw{status:301,statusText:"Failed to fetch: 301"};return{html:o,status:c.status,success:!0,url:e}}catch(c){return c.status===301||c.status===429?{html:"",status:301,success:!1,url:e}:{html:`Could not fetch the page: ${c.message}. Make sure the URL is correct.`,status:404,success:!1,url:e}}};async function qt(e,t){let r=0;const c=t.map(async h=>{try{const n=await e(ie.WEB_ACCESS.GET_HTML_FROM_URL,"GET_DTATA_FROM_URLS",{successfulGet:r,url:h.url});if(n.success&&n.status===200){r++;const a=At(n.html);return{...h,html:a}}}catch{}return null});return(await Promise.all(c)).filter(h=>h!==null)}const xt=(e,t,r=!1)=>{try{const c=new DOMParser().parseFromString(e,"text/html"),o=[];switch(t){case"google":{if(r){const n=c.querySelectorAll("#search #rso > div a[data-ved]");n&&n.forEach(a=>{try{const s=a.querySelectorAll("div[role=heading]");s&&s.forEach(i=>{var f,p;try{const w=i.textContent,A=((f=i.nextElementSibling)==null?void 0:f.textContent)||"";let g="";const d=a.querySelector("g-img");let u="";if(d){const y=d.querySelector("img");y&&(u=y.getAttribute("src")||"");const C=(p=d.parentElement)==null?void 0:p.querySelector("span");C&&(g=C.textContent||"")}if(!u){const y=a.querySelector("img");y&&(u=y.getAttribute("src")||"")}const m=a.getAttribute("href")??"";u&&u.includes("////")&&(u=U(m)),o.push({body:(A.includes("ago")?w:A)||w,from:g,imgLink:u,title:w,url:m})}catch{}})}catch{}})}else{const n=c.querySelectorAll("#search #rso > div");if(n.length===1){const a=c.querySelectorAll("#rso #kp-wp-tab-overview:not([style])");a&&a.forEach(i=>{try{const f=i.querySelectorAll('div[class*="K7khPe"]');f.length>0&&f.forEach(p=>{var w,A,g,d,u;try{const m=p.querySelector("a > h3");let y="",C="",E="",v="",O="";if(y=((w=p.querySelector("div.MUxGbd"))==null?void 0:w.textContent)||"",!y){const S=p.querySelector('div[jscontroller="SC7lYd"'),x=S==null?void 0:S.querySelector("div.ieodic");if(x){const T=x.querySelector("span");T&&(y=T.textContent||"")}if(!y){const T=(A=S==null?void 0:S.firstChild)==null?void 0:A.children[1];T&&(y=T.textContent||"")}}if(!y)try{const S=p.querySelector('div[style*="-webkit-line-clamp"]');y=S?(g=S.textContent)==null?void 0:g.trim():null}catch{}const L=m&&m.closest("a");O=(L==null?void 0:L.getAttribute("href"))??"",v=m==null?void 0:m.textContent;const k=m==null?void 0:m.nextElementSibling;C=k&&(k!=null&&k.lastElementChild)?(u=(d=k==null?void 0:k.lastElementChild)==null?void 0:d.firstElementChild)==null?void 0:u.textContent:"",E=U(O),o.push({body:y,from:C,imgLink:E,title:v,url:O})}catch{}})}catch{}});const s=c.querySelectorAll("#search #rso > div a[data-ved]");s&&s.forEach(i=>{try{const f=i.querySelectorAll("div[role=heading]");f&&f.forEach(p=>{var w,A;try{const g=p.textContent,d=((w=p.nextElementSibling)==null?void 0:w.textContent)||"";let u="";const m=i.querySelector("g-img");let y="";if(m){const E=m.querySelector("img");E&&(y=E.getAttribute("src")||"");const v=(A=m.parentElement)==null?void 0:A.querySelector("span");v&&(u=v.textContent||"")}if(!y){const E=i.querySelector("img");E&&(y=E.getAttribute("src")||"")}const C=i.getAttribute("href")??"";y&&y.includes("////")&&(y=U(C)),o.push({body:(d.includes("ago")?g:d)||g,from:u,imgLink:y,title:g,url:C})}catch{}})}catch{}})}else n.forEach(s=>{var i,f,p,w,A,g,d,u,m,y,C,E,v,O,L;try{const k=s.querySelector("a > h3");if(!k)return;const S=k.closest("a");let x=((f=(i=s.querySelector("div.MUxGbd"))==null?void 0:i.textContent)==null?void 0:f.trim())||"";if(x||(x=((d=(g=(A=(w=(p=S==null?void 0:S.parentElement)==null?void 0:p.parentElement)==null?void 0:w.parentElement)==null?void 0:A.nextSibling)==null?void 0:g.textContent)==null?void 0:d.trim())||""),x||(x=((v=(E=(C=(y=(m=(u=S==null?void 0:S.parentElement)==null?void 0:u.parentElement)==null?void 0:m.parentElement)==null?void 0:y.nextSibling)==null?void 0:C.nextSibling)==null?void 0:E.textContent)==null?void 0:v.trim())||""),!x){const N=s.querySelector('div[style*="-webkit-line-clamp"]');x=((O=N==null?void 0:N.textContent)==null?void 0:O.trim())||""}let T="";const M=k.nextSibling;if(M){const N=M.children;N&&N.length&&(T=N[N.length-1].textContent||"")}const K=S?S.getAttribute("href"):"";o.push({body:x||(k==null?void 0:k.textContent),from:T,imgLink:(L=M==null?void 0:M.querySelector("img"))==null?void 0:L.getAttribute("src"),title:k==null?void 0:k.textContent,url:K})}catch{}}),(c.querySelectorAll('div[jscontroller="SC7lYd"')||[]).forEach(s=>{var i,f,p;try{const w=s.querySelector("a");if(!w)return;const A=(w==null?void 0:w.getAttribute("href"))??"";if(o.find(C=>C.url===A))return;const g=s.querySelector("a > h3, h3, a");if(!g)return;let d=((i=s.querySelector("img"))==null?void 0:i.getAttribute("src"))||"";if(!d){const C=s.querySelector("g-img img");C&&(d=C.getAttribute("src")||"")}d&&d.includes("////")&&(d=U(A));let u=s.querySelector(".VuuXrf");if(!u){const C=s.querySelector("cite"),E=(f=C==null?void 0:C.parentElement)==null?void 0:f.parentElement;u=E==null?void 0:E.querySelector("span")}let m=null;const y=s.querySelector("div.ieodic");if(y&&(m=y.querySelector("span")),!m){const C=(p=s==null?void 0:s.firstChild)==null?void 0:p.children[1];C&&(m=C)}m||(m=s.querySelector('div[style*="-webkit-line-clamp"]')),o.push({body:(m==null?void 0:m.textContent)||"",from:(u==null?void 0:u.textContent)||"",imgLink:d,title:(g==null?void 0:g.textContent)||"",url:A})}catch{}})}break}case"bing":{const n=c.querySelector("ol#b_results");n&&Array.from(n.querySelectorAll("li.b_algo")).forEach(a=>{const s=a.querySelector("h2 > a"),i=a.querySelector(".b_algoSlug"),f=a.querySelector(".b_wikiRichcard .tab-content"),p=a.querySelector("a .tptt"),w=a.querySelector("img.rms_img");let A="";i?A=i.textContent:f&&(A=f.textContent.trim());let g=null;w&&(g=w.getAttribute("src"));let d="";s&&(d=s.getAttribute("href"));let u="";p&&(u=p.textContent),o.push({body:A,from:u,imgLink:g,title:s?s.textContent:"",url:d})});break}case"baidu":{const n=c.querySelector("div#content_left");if(!n)break;n.querySelectorAll("div[class^=result]").forEach(s=>{var i,f,p,w,A;try{const g=s.querySelector("h3"),d=g?g.querySelector("a"):null;if(!d)return;let u=(i=s.querySelector("div[class*='description_']"))==null?void 0:i.textContent;u=u||((f=s.querySelector(".op_dict_content"))==null?void 0:f.textContent),u=u||((p=s.querySelector("div[class*='basis-info_']"))==null?void 0:p.textContent),u=u||((w=s.querySelector(".c-color-text"))==null?void 0:w.textContent),u=u||(g?g.nextElementSibling.nextElementSibling.textContent:null);const m=s.querySelector("a[class^='siteLink']");o.push({body:u??"",from:(m==null?void 0:m.textContent)||"",imgLink:((A=m==null?void 0:m.querySelector("img"))==null?void 0:A.getAttribute("src"))||U((d==null?void 0:d.getAttribute("href"))??"")||"",title:g?g==null?void 0:g.textContent:"",url:d?d.getAttribute("href")??"":""})}catch{}});break}case"yahoo":{r?new DOMParser().parseFromString(e,"text/html").querySelector("#main ol.searchCenterMiddle").querySelectorAll("li ul li").forEach(s=>{var y,C,E;const i=s.querySelector("h4.s-title a"),f=i.querySelector("img"),p=(f==null?void 0:f.getAttribute("src"))??"",w=s.querySelector(".s-source"),A=((y=w==null?void 0:w.textContent)==null?void 0:y.trim())??"",g=((C=i==null?void 0:i.textContent)==null?void 0:C.trim())??"",d=extractRealUrl((i==null?void 0:i.getAttribute("href"))??""),u=s.querySelector("p.s-desc"),m=((E=u==null?void 0:u.textContent)==null?void 0:E.trim())??"";o.push({body:m,from:A,imgLink:p,title:g,url:d})}):c.querySelectorAll('.algo:not([class*="ad"])').forEach(a=>{const s=a.querySelector("h3.title a");if(s){const i=s.getAttribute("href")||"",f=s.querySelector("span");let p=[];f&&(p=f.textContent.split(" › "));const w=a.querySelector(".compText"),A=w?w.textContent:"";o.push({body:A,from:ye(i)||p&&p[0]||"",imgLink:U(i)||"",title:s.getAttribute("aria-label")||"",url:i})}});break}}const h=[];for(let n=0;n<o.length;n++)try{const a={...o[n]};a.from||(a.from=ye(a.url)||""),a.from&&(a.from=a.from.replace(/\.[^.]*$/,""),a.from=oe(a.from)||""),!a.imgLink&&a.url&&(a.imgLink=U(a.url)||""),a.body=oe(a.body)||"",a.title=oe(a.title)||"",h.push(a)}catch{}return h}catch{return[]}};async function te({engine:e,getFromBackground:t,query:r,shouldSearchImage:c=!1,shouldSearchNews:o=!1,timerange:h=null}){try{const n=ve(e,{btf:h,csp:"1",ei:"UTF-8",limit:le,nojs:"1",query:r,region:"wt-wt",shouldSearchImage:c,shouldSearchNews:o,site:null});return await t(ie.WEB_ACCESS.GET_HTML_FROM_URL,"GET_SEARCH_ENGINE_DOM",{signal:null,timeout:4e3,url:n})}catch{}return{html:"",status:404,success:!1,url:""}}const Nt=async(e,t,r,c,o=!1,h)=>{var m,y,C,E,v,O,L,k;let n={response:(((y=(m=r.action.message)==null?void 0:m.metadata)==null?void 0:y.context)??"")+" "+((C=r.action.message)==null?void 0:C.content),shouldGoogle:!0,shouldSearchNews:!1,timerange:null},a=!0;(!h||!(((v=(E=r.action.message)==null?void 0:E.content)==null?void 0:v.length)+(((k=(L=(O=r.action.message)==null?void 0:O.metadata)==null?void 0:L.context)==null?void 0:k.length)??0)<=60))&&a&&(n=await Oe(t,r)),n.shouldGoogle||(o=!0);let{html:s,success:i,url:f}=await te({engine:c,getFromBackground:e,query:(n==null?void 0:n.response)??r.action.message.content,shouldSearchNews:n==null?void 0:n.shouldSearchNews,timerange:n==null?void 0:n.timerange});if(i||(c=c==="google"?"yahoo":"google",{html:s,success:i,url:f}=await te({engine:c,getFromBackground:e,query:(n==null?void 0:n.response)??r.action.message.content,shouldSearchNews:n==null?void 0:n.shouldSearchNews,timerange:n==null?void 0:n.timerange})),i||(c="baidu",{html:s,success:i,url:f}=await te({engine:c,getFromBackground:e,query:(n==null?void 0:n.response)??r.action.message.content,shouldSearchNews:n==null?void 0:n.shouldSearchNews,timerange:n==null?void 0:n.timerange})),!i)return{data:[],decisionResponse:n};const p=new DOMParser().parseFromString(s,"text/html").querySelector("body"),w=(p==null?void 0:p.innerHTML)??"",A=xt(s,c,n==null?void 0:n.shouldSearchNews);if(o){const S=A.map(x=>({...x,html:""}));try{S.push({body:se(p)||"Search results",from:c,html:"",imgLink:U("https://www.google.com/"),title:"Search Results",url:f})}catch{}return{data:S,decisionResponse:n}}const g=await qt(e,A);g.push({body:"Search results",from:c,html:w,imgLink:U("https://www.google.com/"),title:"Search Results",url:f});const d=await Le.fetchQuery(Te);return((d==null?void 0:d.useNewDomClean)===void 0||(d==null?void 0:d.useNewDomClean)===null?!0:d==null?void 0:d.useNewDomClean)&&g.forEach(S=>{try{const x=new DOMParser().parseFromString(S.html,"text/html").querySelector("body");S.html="";let T;try{T=se(x)}catch{T=""}S.body=T??S.body}catch{}}),{data:g,decisionResponse:n}};async function _t(e){const t=new AbortController,r=t.signal,c=setTimeout(()=>{t.abort()},5e3);try{const h=await fetch(e,{headers:{"Content-Type":"text/html","User-Agent":"Chrome/90.0.4430.212"},method:"GET",signal:r});if(!h.ok&&h.status!==200)return"";const n=await h.text();return clearTimeout(c),n}catch{return clearTimeout(c),""}}async function be(e,t){const r=new DOMParser().parseFromString(e,"text/html").querySelectorAll(t),c=[];return r==null||r.forEach(o=>{var h,n,a;try{const s=o==null?void 0:o.getAttribute("data-id"),i=(n=(h=o==null?void 0:o.children[1])==null?void 0:h.children[0])==null?void 0:n.children[0].getAttribute("data-src");i&&c.push({id:s,link:i})}catch{const i=(a=o==null?void 0:o.children[0])==null?void 0:a.children[0].getAttribute("data-src");i&&c.push({link:i})}}),c}async function Ce(e,t,r){return await te({engine:e,getFromBackground:t,query:r,shouldSearchImage:!0,shouldSearchNews:!1,timerange:"m"})}async function Ut(e,t){let r=[],{html:c,success:o,url:h}=await Ce("google",e,t);if(o)r=await be(c,'div[jsname="N9Xkfe"][role="listitem"]');else if({html:c,success:o,url:h}=await Ce("yahoo",e,t),o)r=await be(c,'li[data-bns="API"]');else{const n=ve("baidu",{btf:"m",csp:"1",ei:"UTF-8",limit:le,nojs:"1",query:t,region:"wt-wt",shouldSearchImage:!0,shouldSearchNews:!1,site:null}),a=await e(ie.FETCH_TEXT,"FETCH_IMAGES",{options:{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Encoding":"gzip, deflate, br","Accept-Language":"en-US,en;q=0.5",Connection:"keep-alive",Host:"image.baidu.com"},method:"GET"},url:n});if(!a)return r;try{JSON.parse(a).data.forEach(i=>{const f=i.middleURL;f&&r.push(f)})}catch{JSON.parse(pt(a)).data.forEach(f=>{const p=f.middleURL;p&&r.push(p)})}}return r.slice(0,11),r.slice(0,11)}export{I as A,Q as M,U as a,te as b,xt as c,Dt as d,Ot as e,Ut as f,Nt as g,_t as h};
