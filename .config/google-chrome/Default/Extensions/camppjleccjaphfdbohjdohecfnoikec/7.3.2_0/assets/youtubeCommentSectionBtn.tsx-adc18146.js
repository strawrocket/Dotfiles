import{r as o,E as Y,j as n,a as F}from"./constants-e5712b98.js";import{c as W}from"./font-e4ec73e1.js";import{B as V,u as z}from"./button-e2ac6183.js";import{j as Q,o as $,q as X,Q as Z,i as J}from"./index-5ad58ea9.js";import{A as K,C as tt,R as et,a as st}from"./index-f00bab01.js";import{C as nt}from"./configContext-ec633c64.js";import{c as w}from"./index-f8d4d59a.js";import{c as ot,T as rt,a as it,b as at}from"./tooltip-8f9bc4e6.js";import{s as M,a as N,P as b,Y as I}from"./postMessageConstants-fa0bb197.js";import{f as ct,U as S,n as lt}from"./helpers-966303f4.js";import{u as ut}from"./i18n-6c9556b7.js";import{I as dt}from"./IconLoader-d7588749.js";import{c as mt}from"./index-0c67d257.js";import"./index-fe9d96fe.js";import"./index-3da7154a.js";import"./cloudFunctions-51487c9d.js";import"./cache-2436a988.js";import"./analytics-e24f0cc0.js";import"./createReactComponent-85aa5d18.js";const pt={adsState:!1,errorType:"",queryCost:0,summaryState:null};function ht(){const{...r}=o.useContext(K),s=r.isAuthenticated,c=ct(),{t:e}=ut(),[d,l]=o.useState(0),[L,h]=o.useState(!0),[A,g]=o.useState(!1),[T,E]=o.useState(!1),[_,j]=o.useState(!1),[m,O]=o.useState(pt),[U,P]=o.useState(!1),[H,R]=o.useState(!1),y=o.useRef(null),k=t=>{if(t.preventDefault(),!s){$(F);return}T?R(!0):D(),M({action:N.INITIATE_COMMENT_PROCESS,type:b.FROM_COMMENT_SECTION_HIGHLIGHTS_BUTTON})},D=()=>{l(10),g(!0);const t=lt();y.current=window.setInterval(()=>{l(i=>i<80?i+10:(clearInterval(y.current),85))},t)},C=t=>{if(t.data.type===b.FROM_YT_SUMMARIZER)switch(t.data.action){case I.SET_HIGHLIGHTS_SUCCESS:B();break;case I.UPDATE_COST_AND_ADS_STATE:G(t.data.context);break;case I.RESET_HIGHLIGHTS_BUTTON:q();break}},B=()=>{T?(R(!1),h(!1)):(l(100),clearInterval(y.current),setTimeout(()=>h(!1),3e3),setTimeout(()=>l(0),3500)),E(!0),g(!1)},G=t=>{O(t),t.summaryState===S.SUCCESS&&E(!0),t.summaryState===S.ERROR&&g(!1)},q=()=>{l(0),clearInterval(y.current),h(!0),g(!1),E(!1)};if(o.useEffect(()=>(window.addEventListener("message",C),()=>window.removeEventListener("message",C)),[T]),o.useEffect(()=>{const t=new MutationObserver(u=>{for(const p of u)if(p.type==="childList"&&document.getElementById("contenteditable-root")){j(!0),t.disconnect();return}}),i=document.getElementById("comment-dialog");return i&&t.observe(i,{childList:!0,subtree:!0}),()=>t.disconnect()},[]),o.useEffect(()=>{if(_){const t=document.getElementById("contenteditable-root"),i=document.querySelector("#buttons #cancel-button"),u=document.querySelector("#buttons #submit-button"),p=()=>{h(((t==null?void 0:t.innerText.trim())??"")==="")},f=()=>{h(!0)};return t==null||t.addEventListener("input",p),i==null||i.addEventListener("click",f),u==null||u.addEventListener("click",f),()=>{t==null||t.removeEventListener("input",p),i==null||i.removeEventListener("click",f),u==null||u.removeEventListener("click",f)}}},[_]),o.useEffect(()=>{M({action:N.GET_SHARED_STATE_ON_MOUNTING,type:b.FROM_COMMENT_SECTION_HIGHLIGHTS_BUTTON})},[]),o.useEffect(()=>{let t="";const i=new MutationObserver(()=>{if(location.href!==t){t=location.href;const p=document.domain.replace("www.","")||location.hostname.replace("www.","");P(p==="youtube.com"&&location.pathname.startsWith("/shorts"))}}),u=document.querySelector("title");return u&&i.observe(u,{childList:!0}),()=>i.disconnect()},[]),U)return null;const x=!L||m.adsState;return o.useEffect(()=>{m.summaryState===S.ERROR&&m.errorType===Y.RATE_LIMITED&&window.scrollTo({behavior:"smooth",top:0})},[m]),n.jsx("div",{className:"absolute right-[16px] top-[-20px]",children:n.jsx(ot,{children:n.jsxs(rt,{children:[n.jsx(it,{children:n.jsx("div",{className:w("rounded-full p-[1px]",x?"bg-transparent":"bg-gradient-to-r from-purple-500 to-pink-500"),children:n.jsx(V,{className:w("hover:bg-secondary rounded-full border !border-none border-purple-500",c==="dark"&&"dark"),variant:"secondary",disabled:x,type:"button",onClick:k,children:A||H?n.jsxs("span",{className:"flex items-center justify-center gap-2",children:[n.jsx("span",{className:"animate-loader-spin relative",children:n.jsx(dt,{className:"stroke-black dark:stroke-white",width:18,height:18})}),e("yt_lib.highlights")]}):e(d===100?"yt_lib.highlights_success":"yt_lib.cmnt_highlights")})})}),n.jsx(at,{className:"border-muted-foreground/20 rounded-lg border",sideOffset:8,children:n.jsx("p",{children:m.adsState?e("yt_lib.wait_ad"):m.summaryState===S.SUMMARY?e("yt_lib.highlights_gen"):m.summaryState===S.LOADING?e("yt_lib.highlights_gen1"):`${e("yt_lib.will_use")} ${m.queryCost??4} ${Q(r.usageDetails.type)?e("yt_lib.words"):e("yt_lib.free_summ")}`})})]})})})}let a=null;const ft=()=>{var s,c;return(c=(s=z().details)==null?void 0:s.youtube)!=null&&c.isEnabled?n.jsx(tt,{children:n.jsx(et,{children:n.jsx(nt,{children:n.jsx(st,{children:n.jsx(ht,{})})})})}):null};function St(){return new Promise(r=>{const s=new MutationObserver(J(()=>{const e=document.querySelector("ytd-comments");e&&(r(e),s.disconnect())},50)),c=document.getElementById("page-manager");s.observe(c,{childList:!0,subtree:!0})})}const gt=async r=>{const s=document.createElement("merlin-component");s.id="merlin-yt-comment-button",s.className="merlin yt-comment-button";const c=s.attachShadow({mode:"open"}),e=document.createElement("style");e.textContent=`${mt}
:host(#merlin-yt-comment-button) {
    all: initial; /* 1st rule so subsequent properties are reset. */
    margin: 0;
    padding: 0;
    width: 100%;
    position: absolute;
    box-sizing: border-box;
}
.ytReactAppRoot {
    position: relative;
  z-index: 2000;
  font-family:
		"DM Sans Merlin",
		system-ui,
		-apple-system,
		BlinkMacSystemFont,
		Ubuntu,
		sans-serif !important;
}
`;const d=document.createElement("div");d.id="ytReactAppRoot",d.className="ytReactAppRoot",c.appendChild(e),c.appendChild(d),r(s),W(d).render(n.jsx(ft,{}))},v=()=>{a=new MutationObserver(s=>{s.map(c=>c.addedNodes.forEach(e=>{var d;e.nodeName==="YTD-COMMENT-SIMPLEBOX-RENDERER"&&((d=a==null?void 0:a.disconnect)==null||d.call(a),gt(l=>e.appendChild(l)))}))});const r=document.querySelector("ytd-comments");a==null||a.observe(r,{childList:!0,subtree:!0})},yt=()=>{let r="",s=!0;const c=new MutationObserver(d=>{var l;location.href!==r&&(r=location.href,s||((l=a==null?void 0:a.disconnect)==null||l.call(a),v()),s=!1)}),e=document.querySelector("title");c.observe(e,{childList:!0})},Tt=async()=>{const r=await X.fetchQuery(Z);r&&!r.summarizer.youtube.visible||(await St(),v(),yt())};Tt();
