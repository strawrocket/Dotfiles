(function (){var P=Object.create;var H=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var W=(e,r)=>()=>(e&&(r=e(e=0)),r);var z=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var X=(e,r,n,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of G(r))!Q.call(e,i)&&i!==n&&H(e,i,{get:()=>r[i],enumerable:!(t=j(r,i))||t.enumerable});return e};var Y=(e,r,n)=>(n=e!=null?P(J(e)):{},X(r||!e||!e.__esModule?H(n,"default",{value:e,enumerable:!0}):n,e));var L=W(()=>{});var U=z((k,d)=>{"use strict";L();function u(r){var r=r||{};this.Timeout=r.timeout||1,this.EditCost=r.editCost||4}var _=-1,f=1,p=0;u.Diff;u.prototype.main=function(e,r,n,t){typeof t>"u"&&(this.Timeout<=0?t=Number.MAX_VALUE:t=new Date().getTime()+this.Timeout*1e3);var i=t;if(e==null||r==null)throw new Error("Null input. (diff_main)");if(e==r)return e?[[p,e]]:[];typeof n>"u"&&(n=!0);var a=n,s=this.commonPrefix(e,r),l=e.substring(0,s);e=e.substring(s),r=r.substring(s),s=this.commonSuffix(e,r);var o=e.substring(e.length-s);e=e.substring(0,e.length-s),r=r.substring(0,r.length-s);var c=this.compute_(e,r,a,i);return l&&c.unshift([p,l]),o&&c.push([p,o]),this.cleanupMerge(c),c};u.prototype.compute_=function(e,r,n,t){var i;if(!e)return[[f,r]];if(!r)return[[_,e]];var a=e.length>r.length?e:r,s=e.length>r.length?r:e,l=a.indexOf(s);if(l!=-1)return i=[[f,a.substring(0,l)],[p,s],[f,a.substring(l+s.length)]],e.length>r.length&&(i[0][0]=i[2][0]=_),i;if(s.length==1)return[[_,e],[f,r]];var o=this.halfMatch_(e,r);if(o){var c=o[0],h=o[1],g=o[2],v=o[3],w=o[4],y=this.main(c,g,n,t),C=this.main(h,v,n,t);return y.concat([[p,w]],C)}return n&&e.length>100&&r.length>100?this.lineMode_(e,r,t):this.bisect_(e,r,t)};u.prototype.lineMode_=function(e,r,n){var t=this.linesToChars_(e,r);e=t.chars1,r=t.chars2;var i=t.lineArray,a=this.main(e,r,!1,n);this.charsToLines_(a,i),this.cleanupSemantic(a),a.push([p,""]);for(var s=0,l=0,o=0,c="",h="";s<a.length;){switch(a[s][0]){case f:o++,h+=a[s][1];break;case _:l++,c+=a[s][1];break;case p:if(l>=1&&o>=1){a.splice(s-l-o,l+o),s=s-l-o;for(var t=this.main(c,h,!1,n),g=t.length-1;g>=0;g--)a.splice(s,0,t[g]);s=s+t.length}o=0,l=0,c="",h="";break}s++}return a.pop(),a};u.prototype.bisect_=function(e,r,n){for(var t=e.length,i=r.length,a=Math.ceil((t+i)/2),s=a,l=2*a,o=new Array(l),c=new Array(l),h=0;h<l;h++)o[h]=-1,c[h]=-1;o[s+1]=0,c[s+1]=0;for(var g=t-i,v=g%2!=0,w=0,y=0,C=0,R=0,T=0;T<a&&!(new Date().getTime()>n);T++){for(var m=-T+w;m<=T-y;m+=2){var M=s+m,b;m==-T||m!=T&&o[M-1]<o[M+1]?b=o[M+1]:b=o[M-1]+1;for(var I=b-m;b<t&&I<i&&e.charAt(b)==r.charAt(I);)b++,I++;if(o[M]=b,b>t)y+=2;else if(I>i)w+=2;else if(v){var E=s+g-m;if(E>=0&&E<l&&c[E]!=-1){var A=t-c[E];if(b>=A)return this.bisectSplit_(e,r,b,I,n)}}}for(var S=-T+C;S<=T-R;S+=2){var E=s+S,A;S==-T||S!=T&&c[E-1]<c[E+1]?A=c[E+1]:A=c[E-1]+1;for(var D=A-S;A<t&&D<i&&e.charAt(t-A-1)==r.charAt(i-D-1);)A++,D++;if(c[E]=A,A>t)R+=2;else if(D>i)C+=2;else if(!v){var M=s+g-S;if(M>=0&&M<l&&o[M]!=-1){var b=o[M],I=s+b-M;if(A=t-A,b>=A)return this.bisectSplit_(e,r,b,I,n)}}}}return[[_,e],[f,r]]};u.prototype.bisectSplit_=function(e,r,n,t,i){var a=e.substring(0,n),s=r.substring(0,t),l=e.substring(n),o=r.substring(t),c=this.main(a,s,!1,i),h=this.main(l,o,!1,i);return c.concat(h)};u.prototype.linesToChars_=function(e,r){var n=[],t={};n[0]="";function i(l){for(var o="",c=0,h=-1,g=n.length;h<l.length-1;){h=l.indexOf(`
`,c),h==-1&&(h=l.length-1);var v=l.substring(c,h+1);c=h+1,(t.hasOwnProperty?t.hasOwnProperty(v):t[v]!==void 0)?o+=String.fromCharCode(t[v]):(o+=String.fromCharCode(g),t[v]=g,n[g++]=v)}return o}var a=i(e),s=i(r);return{chars1:a,chars2:s,lineArray:n}};u.prototype.charsToLines_=function(e,r){for(var n=0;n<e.length;n++){for(var t=e[n][1],i=[],a=0;a<t.length;a++)i[a]=r[t.charCodeAt(a)];e[n][1]=i.join("")}};u.prototype.commonPrefix=function(e,r){if(!e||!r||e.charAt(0)!=r.charAt(0))return 0;for(var n=0,t=Math.min(e.length,r.length),i=t,a=0;n<i;)e.substring(a,i)==r.substring(a,i)?(n=i,a=n):t=i,i=Math.floor((t-n)/2+n);return i};u.prototype.commonSuffix=function(e,r){if(!e||!r||e.charAt(e.length-1)!=r.charAt(r.length-1))return 0;for(var n=0,t=Math.min(e.length,r.length),i=t,a=0;n<i;)e.substring(e.length-i,e.length-a)==r.substring(r.length-i,r.length-a)?(n=i,a=n):t=i,i=Math.floor((t-n)/2+n);return i};u.prototype.commonOverlap_=function(e,r){var n=e.length,t=r.length;if(n==0||t==0)return 0;n>t?e=e.substring(n-t):n<t&&(r=r.substring(0,n));var i=Math.min(n,t);if(e==r)return i;for(var a=0,s=1;;){var l=e.substring(i-s),o=r.indexOf(l);if(o==-1)return a;s+=o,(o==0||e.substring(i-s)==r.substring(0,s))&&(a=s,s++)}};u.prototype.halfMatch_=function(e,r){if(this.Timeout<=0)return null;var n=e.length>r.length?e:r,t=e.length>r.length?r:e;if(n.length<4||t.length*2<n.length)return null;var i=this;function a(y,C,R){for(var T=y.substring(R,R+Math.floor(y.length/4)),m=-1,M="",b,I,E,A;(m=C.indexOf(T,m+1))!=-1;){var S=i.commonPrefix(y.substring(R),C.substring(m)),D=i.commonSuffix(y.substring(0,R),C.substring(0,m));M.length<D+S&&(M=C.substring(m-D,m)+C.substring(m,m+S),b=y.substring(0,R-D),I=y.substring(R+S),E=C.substring(0,m-D),A=C.substring(m+S))}return M.length*2>=y.length?[b,I,E,A,M]:null}var s=a(n,t,Math.ceil(n.length/4)),l=a(n,t,Math.ceil(n.length/2)),o;if(!s&&!l)return null;l?s?o=s[4].length>l[4].length?s:l:o=l:o=s;var c,h,g,v;e.length>r.length?(c=o[0],h=o[1],g=o[2],v=o[3]):(g=o[0],v=o[1],c=o[2],h=o[3]);var w=o[4];return[c,h,g,v,w]};u.prototype.cleanupSemantic=function(e){for(var r=!1,n=[],t=0,i=null,a=0,s=0,l=0,o=0,c=0;a<e.length;)e[a][0]==p?(n[t++]=a,s=o,l=c,o=0,c=0,i=e[a][1]):(e[a][0]==f?o+=e[a][1].length:c+=e[a][1].length,i&&i.length<=Math.max(s,l)&&i.length<=Math.max(o,c)&&(e.splice(n[t-1],0,[_,i]),e[n[t-1]+1][0]=f,t--,t--,a=t>0?n[t-1]:-1,s=0,l=0,o=0,c=0,i=null,r=!0)),a++;for(r&&this.cleanupMerge(e),this.cleanupSemanticLossless(e),a=1;a<e.length;){if(e[a-1][0]==_&&e[a][0]==f){var h=e[a-1][1],g=e[a][1],v=this.commonOverlap_(h,g),w=this.commonOverlap_(g,h);v>=w?(v>=h.length/2||v>=g.length/2)&&(e.splice(a,0,[p,g.substring(0,v)]),e[a-1][1]=h.substring(0,h.length-v),e[a+1][1]=g.substring(v),a++):(w>=h.length/2||w>=g.length/2)&&(e.splice(a,0,[p,h.substring(0,w)]),e[a-1][0]=f,e[a-1][1]=g.substring(0,g.length-w),e[a+1][0]=_,e[a+1][1]=h.substring(w),a++),a++}a++}};u.prototype.cleanupSemanticLossless=function(e){function r(w,y){if(!w||!y)return 6;var C=w.charAt(w.length-1),R=y.charAt(0),T=C.match(u.nonAlphaNumericRegex_),m=R.match(u.nonAlphaNumericRegex_),M=T&&C.match(u.whitespaceRegex_),b=m&&R.match(u.whitespaceRegex_),I=M&&C.match(u.linebreakRegex_),E=b&&R.match(u.linebreakRegex_),A=I&&w.match(u.blanklineEndRegex_),S=E&&y.match(u.blanklineStartRegex_);return A||S?5:I||E?4:T&&!M&&b?3:M||b?2:T||m?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==p&&e[n+1][0]==p){var t=e[n-1][1],i=e[n][1],a=e[n+1][1],s=this.commonSuffix(t,i);if(s){var l=i.substring(i.length-s);t=t.substring(0,t.length-s),i=l+i.substring(0,i.length-s),a=l+a}for(var o=t,c=i,h=a,g=r(t,i)+r(i,a);i.charAt(0)===a.charAt(0);){t+=i.charAt(0),i=i.substring(1)+a.charAt(0),a=a.substring(1);var v=r(t,i)+r(i,a);v>=g&&(g=v,o=t,c=i,h=a)}e[n-1][1]!=o&&(o?e[n-1][1]=o:(e.splice(n-1,1),n--),e[n][1]=c,h?e[n+1][1]=h:(e.splice(n+1,1),n--))}n++}};u.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;u.whitespaceRegex_=/\s/;u.linebreakRegex_=/[\r\n]/;u.blanklineEndRegex_=/\n\r?\n$/;u.blanklineStartRegex_=/^\r?\n\r?\n/;u.prototype.cleanupEfficiency=function(e){for(var r=!1,n=[],t=0,i=null,a=0,s=!1,l=!1,o=!1,c=!1;a<e.length;)e[a][0]==p?(e[a][1].length<this.EditCost&&(o||c)?(n[t++]=a,s=o,l=c,i=e[a][1]):(t=0,i=null),o=c=!1):(e[a][0]==_?c=!0:o=!0,i&&(s&&l&&o&&c||i.length<this.EditCost/2&&s+l+o+c==3)&&(e.splice(n[t-1],0,[_,i]),e[n[t-1]+1][0]=f,t--,i=null,s&&l?(o=c=!0,t=0):(t--,a=t>0?n[t-1]:-1,o=c=!1),r=!0)),a++;r&&this.cleanupMerge(e)};u.prototype.cleanupMerge=function(e){e.push([p,""]);for(var r=0,n=0,t=0,i="",a="",s;r<e.length;)switch(e[r][0]){case f:t++,a+=e[r][1],r++;break;case _:n++,i+=e[r][1],r++;break;case p:n+t>1?(n!==0&&t!==0&&(s=this.commonPrefix(a,i),s!==0&&(r-n-t>0&&e[r-n-t-1][0]==p?e[r-n-t-1][1]+=a.substring(0,s):(e.splice(0,0,[p,a.substring(0,s)]),r++),a=a.substring(s),i=i.substring(s)),s=this.commonSuffix(a,i),s!==0&&(e[r][1]=a.substring(a.length-s)+e[r][1],a=a.substring(0,a.length-s),i=i.substring(0,i.length-s))),n===0?e.splice(r-t,n+t,[f,a]):t===0?e.splice(r-n,n+t,[_,i]):e.splice(r-n-t,n+t,[_,i],[f,a]),r=r-n-t+(n?1:0)+(t?1:0)+1):r!==0&&e[r-1][0]==p?(e[r-1][1]+=e[r][1],e.splice(r,1)):r++,t=0,n=0,i="",a="";break}e[e.length-1][1]===""&&e.pop();var l=!1;for(r=1;r<e.length-1;)e[r-1][0]==p&&e[r+1][0]==p&&(e[r][1].substring(e[r][1].length-e[r-1][1].length)==e[r-1][1]?(e[r][1]=e[r-1][1]+e[r][1].substring(0,e[r][1].length-e[r-1][1].length),e[r+1][1]=e[r-1][1]+e[r+1][1],e.splice(r-1,1),l=!0):e[r][1].substring(0,e[r+1][1].length)==e[r+1][1]&&(e[r-1][1]+=e[r+1][1],e[r][1]=e[r][1].substring(e[r+1][1].length)+e[r+1][1],e.splice(r+1,1),l=!0)),r++;l&&this.cleanupMerge(e)};u.prototype.xIndex=function(e,r){var n=0,t=0,i=0,a=0,s;for(s=0;s<e.length&&(e[s][0]!==f&&(n+=e[s][1].length),e[s][0]!==_&&(t+=e[s][1].length),!(n>r));s++)i=n,a=t;return e.length!=s&&e[s][0]===_?a:a+(r-i)};u.prototype.prettyHtml=function(e){for(var r=[],n=/&/g,t=/</g,i=/>/g,a=/\n/g,s=0;s<e.length;s++){var l=e[s][0],o=e[s][1],c=o.replace(n,"&amp;").replace(t,"&lt;").replace(i,"&gt;").replace(a,"<br/>");switch(l){case f:r[s]="<ins>"+c+"</ins>";break;case _:r[s]="<del>"+c+"</del>";break;case p:r[s]="<span>"+c+"</span>";break}}return r.join("")};u.prototype.text1=function(e){for(var r=[],n=0;n<e.length;n++)e[n][0]!==f&&(r[n]=e[n][1]);return r.join("")};u.prototype.text2=function(e){for(var r=[],n=0;n<e.length;n++)e[n][0]!==_&&(r[n]=e[n][1]);return r.join("")};u.prototype.levenshtein=function(e){for(var r=0,n=0,t=0,i=0;i<e.length;i++){var a=e[i][0],s=e[i][1];switch(a){case f:n+=s.length;break;case _:t+=s.length;break;case p:r+=Math.max(n,t),n=0,t=0;break}}return r+=Math.max(n,t),r};u.prototype.toDelta=function(e){for(var r=[],n=0;n<e.length;n++)switch(e[n][0]){case f:r[n]="+"+encodeURI(e[n][1]);break;case _:r[n]="-"+e[n][1].length;break;case p:r[n]="="+e[n][1].length;break}return r.join("	").replace(/%20/g," ")};u.prototype.fromDelta=function(e,r){for(var n=[],t=0,i=0,a=r.split(/\t/g),s=0;s<a.length;s++){var l=a[s].substring(1);switch(a[s].charAt(0)){case"+":try{n[t++]=[f,decodeURI(l)]}catch{throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var o=parseInt(l,10);if(isNaN(o)||o<0)throw new Error("Invalid number in diff_fromDelta: "+l);var c=e.substring(i,i+=o);a[s].charAt(0)=="="?n[t++]=[p,c]:n[t++]=[_,c];break;default:if(a[s])throw new Error("Invalid diff operation in diff_fromDelta: "+a[s])}}if(i!=e.length)throw new Error("Delta length ("+i+") does not equal source text length ("+e.length+").");return n};k.diff=u;k.DIFF_DELETE=_;k.DIFF_INSERT=f;k.DIFF_EQUAL=p;d.exports=u});L();var B=Y(U()),$=!1,F=(...e)=>$&&console.log("codemirror-script",...e),N=(e,r=50)=>{let n;return()=>{n&&clearTimeout(n),n=setTimeout(()=>{n=void 0,e()},r)}},O=class{constructor(r,n){this.element=r;this.inst=n;this.generation=0;this.currentText="";this.onRefresh=(()=>{let r;return()=>{let{scroller:n}=this.inst.display;r&&clearTimeout(r),r=setTimeout(()=>{r=void 0;let{scrollTop:t}=n;n.scrollTop+=10,t===n.scrollTop&&(n.scrollTop-=10),n.scrollTop=t},500)}})();this.onSelection=()=>{let{inst:r,element:n}=this,t=Array.from(n.querySelectorAll(".CodeMirror-selected")).map(i=>Array.from(i.getClientRects())).filter(i=>!!i.length).sort((i,a)=>Math.sign(i[0].y-a[0].y)).flatMap(i=>i).map(({x:i,y:a,width:s,height:l})=>[i,a,s,l]);this.send({type:"selection",clientRects:t,text:r.getSelection()})};this.onCursor=()=>{let{inst:r,element:n}=this,t=n.querySelector(".CodeMirror-cursor")?.getClientRects();if(t?.length===1){let i=0,a=t[0],s=[a.x,a.y,a.width,a.height],l=r.getCursor(),o=r.getValue();for(let c=0;c<=l.line;c++){let h=r.getLine(c);i=o.indexOf(h,i)}i+=l.ch,this.send({type:"cursor",rect:s,textOffset:i})}};this.onChange=r=>{let{inst:n}=this,t=n.getValue(),i=n.getRange({line:0,ch:0},{line:n.getViewport().from,ch:0}).length;r?(this.generation=0,this.currentText=""):this.generation++;let a=new B.default,s=a.main(this.currentText,t),l=a.toDelta(s);this.currentText=t,this.send({type:"change",diff:l,textOffset:i,id:this.generation})};let{onSelection:t,onCursor:i,onChange:a}=this;n.on("beforeSelectionChange",N(t)),n.on("cursorActivity",N(i));let s=N(()=>a(!1));n.on("viewportChange",()=>{s(),this.onRefresh()}),n.on("change",()=>{s(),this.onRefresh()}),n.on("inputRead",()=>{s(),this.onRefresh()}),n.on("refresh",()=>{s(),this.onRefresh()})}get entryId(){return this.element.getAttribute("data-writer-document-id")}send(r){F("send",r),Object.assign(r,{entryId:this.entryId}),this.element.ownerDocument.defaultView?.postMessage(r)}getLineOffset(r){let{inst:n}=this,t=0,i=n.getValue(),a=n.lineCount();for(let s=0;s<a;s++){let l=n.getLine(s),o=l.length,c=i.indexOf(l,t);if(c<=r&&r<=c+o)return{line:s,ch:r-c};t=c+o}}},V=class{constructor(r){this.wnd=r;this.map=new Map;this.integrate=r=>{let{map:n}=this,{CodeMirror:t}=r;if(t&&!n.has(r)){F("integrate",r);let i=new O(r,t);n.set(r,i),i.onChange(!0)}};this.onFocus=r=>{F("onFocus",r);let{activeElement:n}=this.wnd.document,t=n?.tagName==="BODY"?n.querySelector(".CodeMirror"):n?.closest(".CodeMirror");this.cleanup(),t&&this.integrate(t)};this.onMessage=r=>{let{map:n}=this,{data:t}=r,i=Array.from(n.values()).find(s=>s.entryId===t.entryId);if(!i)return;F("MESSAGE",t);let{inst:a}=i;switch(t.type){case"scrollTo":{let l=i.getLineOffset(t.until*.5+t.from*.5),o=a.getScrollInfo();if(l){let{scroller:c}=a.display,h=c.getBoundingClientRect(),g=t.left+o.left,v=t.top+o.top,w=g-h.left-o.clientWidth/2,y=v-h.top-o.clientHeight/2;c.scrollTo(this.positive(w),this.positive(y))}break}case"replaceRange":let s=a[t.type](...t.args);i.send({type:"response",data:t,result:s});break;case"getValue":i.onChange(!0);break;case"applyReplacement":{if(t.fromUntil==="selection")a.getSelection()===t.originalValue?a.replaceSelection(t.suggestionValue):console.error("Invalid selection",{real:a.getSelection(),selection:t.originalValue});else{let{from:l,until:o}=t.fromUntil,c=i.getLineOffset(l),h=i.getLineOffset(o);c&&h&&a.replaceRange(t.suggestionValue,c,h,t.originalValue)}break}default:break}};this.refresh=()=>{this.cleanup();let r=this.wnd.document.querySelectorAll(".CodeMirror");Array.from(r).forEach(n=>this.integrate(n))}}init(r=2e3){let{wnd:n}=this;n.document.addEventListener("focus",this.onFocus),n.addEventListener("message",this.onMessage);let t=setInterval(this.refresh,r);return this.refresh(),()=>{clearInterval(t),n.document.removeEventListener("focus",this.onFocus),n.removeEventListener("message",this.onMessage)}}positive(r){return r<0?0:r}cleanup(){this.map.keys().filter(n=>!n.isConnected).forEach(n=>{F("delete",n),this.map.delete(n)})}};new V(globalThis.window).init();
})();